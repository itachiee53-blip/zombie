<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Super Vocab Pro Max: Ultra Smooth üöÄ</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- ‚ö° PERFORMANCE & GLOBAL SETTINGS --- */
        :root { 
            --primary: #6c5ce7; 
            --primary-dark: #4834d4;
            --accent: #fdcb6e; 
            --success: #00b894; 
            --danger: #ff7675; 
            --text-main: #2d3436;
            --text-sub: #636e72;
            --bg-gradient: linear-gradient(135deg, #a29bfe 0%, #74b9ff 100%);
            --radius: 24px;
        }
        
        * {
            /* ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏Ñ‡∏°‡∏ä‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡∏Å */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            box-sizing: border-box;
            /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡∏∞‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
            -webkit-tap-highlight-color: transparent; 
        }

        body { 
            font-family: 'Sarabun', sans-serif; 
            background: var(--bg-gradient); 
            min-height: 100vh; 
            margin: 0; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            color: var(--text-main);
            padding: 15px; 
            overflow-x: hidden;
        }

        .container { 
            width: 96%; 
            max-width: 1200px; 
            background: rgba(255, 255, 255, 0.98); 
            padding: 25px; 
            border-radius: var(--radius); 
            /* üî• GPU HACK: ‡∏•‡∏î‡∏†‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏î‡πÄ‡∏á‡∏≤ */
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15); 
            display: flex;
            flex-direction: column;
            position: relative;
            margin: auto;
            min-height: 85vh;
            /* üî• Force GPU Layer */
            transform: translateZ(0);
            will-change: transform, opacity;
        }

        /* --- Header --- */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .app-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary-dark);
            margin: 0;
            letter-spacing: -0.5px;
        }
        .header-actions button {
            background: #fff0f0; border: none; width: 40px; height: 40px; border-radius: 12px;
            color: var(--danger); font-size: 1.1rem; cursor: pointer; transition: transform 0.1s;
            display: flex; justify-content: center; align-items: center;
        }
        .header-actions button:active { transform: scale(0.95); }

        /* --- üî• PROFILE CARD (Optimized Animation) --- */
        .profile-card { 
            /* ‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡∏ô Gradient ‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ü‡∏£‡∏° */
            background: linear-gradient(120deg, #6c5ce7, #74b9ff);
            background-size: 200% 200%;
            animation: gradientBG 8s ease infinite; /* ‡∏ä‡πâ‡∏≤‡∏•‡∏á‡∏´‡∏ô‡πà‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ CPU ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏•‡∏á */
            color: white; 
            padding: 25px; 
            border-radius: 24px; 
            box-shadow: 0 15px 35px rgba(108, 92, 231, 0.3);
            margin-bottom: 25px; 
            position: relative; overflow: hidden;
            /* üî• GPU Layer */
            transform: translate3d(0,0,0);
        }
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .profile-top {
            display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;
        }
        .profile-info { flex-grow: 1; z-index: 2; position: relative; }
        .rank-label { 
            font-size: 0.85rem; opacity: 0.9; font-weight: 600; 
            letter-spacing: 1px; text-transform: uppercase; 
            margin-bottom: 5px; display: block;
        }
        .rank-name { 
            font-size: 2rem; font-weight: 800; margin: 0; 
            text-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        
        .profile-avatar {
            font-size: 3.5rem;
            background: rgba(255, 255, 255, 0.2);
            width: 80px; height: 80px;
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            z-index: 2; position: relative;
            /* ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏•‡∏≠‡∏¢‡πÄ‡∏ö‡∏≤‡πÜ */
            animation: floatAvatar 4s ease-in-out infinite;
        }
        @keyframes floatAvatar {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .xp-wrapper { margin-bottom: 20px; position: relative; z-index: 2; }
        .xp-header { display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 5px; font-weight: 600; opacity: 0.9; }
        .xp-track { background: rgba(0,0,0,0.2); height: 10px; border-radius: 10px; overflow: hidden; }
        .xp-fill { 
            background: #ffeaa7; height: 100%; width: 0%; 
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); /* ‡πÄ‡∏£‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß transition */
            box-shadow: 0 0 10px rgba(255, 234, 167, 0.6);
        }

        .stats-row {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; position: relative; z-index: 2;
        }
        .stat-box {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 16px; padding: 10px; text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .stat-val { font-size: 1.2rem; font-weight: 800; display: block; }
        .stat-label { font-size: 0.75rem; opacity: 0.85; font-weight: 400; }

        /* --- Badge Scroller --- */
        .badge-section { margin-bottom: 20px; }
        .section-title { font-size: 0.9rem; font-weight: 700; margin-bottom: 10px; color: var(--text-sub); display: block; text-transform: uppercase; letter-spacing: 0.5px; }
        .badge-bar { 
            display: flex; gap: 10px; overflow-x: auto; padding: 5px 5px 15px 5px; 
            scrollbar-width: none;
            /* üî• GPU Scroll */
            -webkit-overflow-scrolling: touch;
        }
        .badge-bar::-webkit-scrollbar { display: none; }
        
        .badge-item { 
            min-width: 50px; height: 50px; 
            background: #f1f2f6; border-radius: 16px; 
            display: flex; justify-content: center; align-items: center; 
            font-size: 1.6rem; 
            filter: grayscale(1); opacity: 0.5; 
            transition: transform 0.2s, filter 0.2s, opacity 0.2s; 
            cursor: pointer; position: relative; border: 2px solid transparent;
        }
        .badge-item.active { filter: grayscale(0); opacity: 1; background: white; border-color: var(--accent); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .badge-item:active { transform: scale(0.95); }
        .mult { position: absolute; top: -5px; right: -5px; background: var(--danger); color: white; font-size: 0.6rem; padding: 2px 5px; border-radius: 8px; font-weight: bold; border: 2px solid white; }

        /* --- Category Selector --- */
        .cat-wrapper { margin-bottom: 25px; position: relative; z-index: 100; }
        .custom-select { 
            background: #f1f2f6; padding: 12px 20px; border-radius: 16px; 
            display: flex; justify-content: space-between; align-items: center;
            cursor: pointer; font-weight: 700; color: var(--text-main);
            transition: background 0.2s; font-size: 1rem;
        }
        .custom-select:active { background: #dfe6e9; }
        .options-list { 
            position: absolute; top: 110%; left: 0; right: 0; 
            background: white; border-radius: 16px; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.15); 
            max-height: 300px; overflow-y: auto; display: none; 
            padding: 10px; border: 1px solid #eee;
            /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∑‡πà‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î List */
            animation: fadeIn 0.15s ease-out;
        }
        .open .options-list { display: block; }
        .opt-item { padding: 12px; border-radius: 10px; color: var(--text-main); font-size: 0.95rem; font-weight: 500; }
        .opt-item:active { background: #f0f3f8; color: var(--primary); }

        /* --- Game Menu Grid --- */
        .game-menu { display: grid; gap: 20px; }

        .card-main-game {
            grid-column: 1 / -1;
            background: linear-gradient(to right, #ffffff, #f8f9fe);
            border-radius: 20px; padding: 20px 25px;
            display: flex; align-items: center; justify-content: space-between;
            box-shadow: 0 5px 15px rgba(0,0,0,0.04);
            cursor: pointer; transition: transform 0.1s, box-shadow 0.1s;
            border: 2px solid #eef2f7; min-height: 80px; 
            transform: translateZ(0); /* Force GPU */
        }
        .card-main-game:active { transform: scale(0.98); border-color: var(--primary); }
        .card-main-game .icon-box {
            width: 50px; height: 50px; background: #eeedff; border-radius: 14px;
            display: flex; justify-content: center; align-items: center; font-size: 1.6rem; color: var(--primary);
        }
        .card-main-game .text-box { flex-grow: 1; margin-left: 20px; text-align: left; }
        .card-main-game h3 { margin: 0; font-size: 1.2rem; color: var(--primary-dark); font-weight: 800; }
        .card-main-game p { margin: 3px 0 0; font-size: 0.9rem; color: var(--text-sub); }
        .card-main-game .arrow { color: var(--primary); font-size: 1.2rem; font-weight: 900; }

        .mini-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 20px;
        }
        .mini-card {
            background: white; border-radius: 20px; padding: 20px; text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.03); border: 2px solid #eef2f7;
            cursor: pointer; transition: transform 0.1s;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 120px; transform: translateZ(0); /* Force GPU */
        }
        .mini-card:active { transform: scale(0.96); border-color: #b2bec3; }
        .mini-icon { font-size: 2.2rem; margin-bottom: 10px; }
        .mini-label { font-weight: 700; font-size: 1rem; color: var(--text-main); }
        
        .footer-reset { margin-top: 30px; text-align: center; }
        .footer-reset button {
            background: none; border: none; color: #b2bec3; 
            font-size: 0.85rem; text-decoration: underline; cursor: pointer; transition: color 0.2s;
        }

        /* --- üöÄ SMOOTH SCREEN TRANSITIONS --- */
        .hidden { display: none !important; }
        
        /* ‡∏Ñ‡∏•‡∏≤‡∏™‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤ */
        .fade-in {
            animation: fadeInScreen 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        @keyframes fadeInScreen {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

        /* Screens Layout */
        #screen-mode, #screen-game, #screen-tf, #screen-vowel, #screen-sentence, #screen-end {
            width: 100%; text-align: center; margin: auto; max-width: 800px;
        }

        /* Elements inside Game */
        .big-btn { width: 100%; padding: 15px; border-radius: 16px; font-weight: bold; font-size: 1rem; cursor: pointer; margin-bottom: 12px; border: none; }
        .next-btn { 
            background: var(--primary); color: white; border: none; padding: 15px; border-radius: 50px; width: 100%; 
            font-weight: 800; font-size: 1.1rem; margin-top: 20px; cursor: pointer; 
            box-shadow: 0 8px 25px rgba(108, 92, 231, 0.4); transition: transform 0.1s;
        }
        .next-btn:active { transform: scale(0.98); }
        
        .question-box { 
            background: #f8f9fa; padding: 30px 20px; border-radius: 20px; margin: 20px 0; position: relative; border: 1px solid #eef2f7; 
            min-height: 120px; display: flex; flex-direction: column; justify-content: center;
            transform: translateZ(0);
        }
        .word-en { color: var(--primary-dark); font-weight: 800; line-height: 1.2; font-size: 2rem !important; }
        .word-read { font-size: 1rem; color: #636e72; font-style: italic; margin-top: 8px; }

        .choices-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; } 
        .choice-btn { 
            background: white; border: 2px solid #dfe6e9; border-radius: 16px; 
            color: var(--text-main); font-weight: 700; transition: background 0.1s; font-size: 1rem;
            box-shadow: 0 4px 0 #dfe6e9; min-height: 70px; display: flex; align-items: center; justify-content: center; padding: 10px;
        }
        .choice-btn:active { transform: translateY(4px); box-shadow: none; }

        .tf-grid, .vowel-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .tf-btn { border-radius: 20px; box-shadow: 0 5px 0 rgba(0,0,0,0.1); font-size: 1.4rem !important; height: 100px !important; }
        .vowel-btn { border-radius: 16px; box-shadow: 0 4px 0 #bdc3c7; border: 2px solid #bdc3c7; background: white; color: var(--text-main); font-size: 1.6rem !important; height: 80px !important;}
        
        .word-chip { background: white; border: 2px solid var(--primary); color: var(--primary); box-shadow: 0 3px 0 var(--primary); margin: 5px; padding: 8px 16px; font-size: 1rem; border-radius: 25px; transition: transform 0.1s; }
        .word-chip:active { transform: scale(0.95); box-shadow: none; }
        .sentence-box { border-radius: 16px; border: 2px dashed #b2bec3; background: #fafafa; min-height: 100px; display: flex; flex-wrap: wrap; align-items: center; justify-content: center; gap: 8px; padding: 15px; }

        /* Combo & Anim */
        .combo-badge {
            background: linear-gradient(45deg, #f1c40f, #e67e22); color: white; padding: 5px 15px; border-radius: 20px; font-weight: 900; font-size: 0.9rem;
            box-shadow: 0 4px 10px rgba(230, 126, 34, 0.4); display: inline-flex; align-items: center; gap: 5px; animation: pulse-combo 0.5s infinite alternate;
        }
        .combo-high { background: linear-gradient(45deg, #e74c3c, #c0392b); box-shadow: 0 4px 15px rgba(231, 76, 60, 0.5); transform: scale(1.1); }
        .combo-god { background: linear-gradient(45deg, #8e44ad, #3498db); box-shadow: 0 0 20px rgba(142, 68, 173, 0.6); }
        @keyframes pulse-combo { from { transform: scale(1); } to { transform: scale(1.1); } }
        
        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 1000; display: flex; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; }
        
/* --- üî• TINDER SWIPE STYLES --- */
.tinder-container {
    position: relative;
    width: 100%;
    height: 400px; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡πå‡∏î */
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    margin-top: 20px;
}

.tinder-card {
    width: 100%;
    max-width: 340px;
    height: 100%;
    background: white;
    border-radius: 20px;
    box-shadow: 0 15px 35px rgba(0,0,0,0.15);
    position: absolute;
    padding: 30px 20px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    cursor: grab;
    transform-origin: 50% 100%;
    will-change: transform;
    border: 1px solid #eef2f7;
    /* ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏π‡∏î */
    user-select: none; 
}

.tinder-card:active {
    cursor: grabbing;
}

/* ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ö‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏î */
.swipe-status {
    position: absolute;
    top: 40px;
    font-size: 3rem;
    font-weight: 900;
    opacity: 0;
    transform: rotate(-15deg);
    border: 4px solid;
    padding: 5px 15px;
    border-radius: 10px;
    pointer-events: none;
    z-index: 10;
}

.status-yes {
    left: 20px;
    color: #00b894;
    border-color: #00b894;
    transform: rotate(-20deg);
}

.status-no {
    right: 20px;
    color: #ff7675;
    border-color: #ff7675;
    transform: rotate(20deg);
}

/* ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á (‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏ô‡∏±‡∏î‡∏õ‡∏±‡∏î) */
.tinder-controls {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin-top: 20px;
}

.control-btn {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    border: none;
    background: white;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    font-size: 1.8rem;
    cursor: pointer;
    transition: transform 0.2s;
    display: flex; justify-content: center; align-items: center;
}
.control-btn:active { transform: scale(0.9); }
.btn-no { color: #ff7675; border: 2px solid #ff7675; }
.btn-yes { color: #00b894; border: 2px solid #00b894; }

/* Animation ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≠‡∏ô‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏°‡∏∑‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏î‡πâ‡∏á‡∏≠‡∏≠‡∏Å */
.fly-left { animation: flyOutLeft 0.5s forwards; }
.fly-right { animation: flyOutRight 0.5s forwards; }

@keyframes flyOutLeft {
    to { transform: translate(-150%, 50px) rotate(-30deg); opacity: 0; }
}
@keyframes flyOutRight {
    to { transform: translate(150%, 50px) rotate(30deg); opacity: 0; }
}
/* --- üÉè FLASHCARD PREMIUM STYLES --- */
.flashcard-container {
    perspective: 1000px; width: 100%; height: 380px; margin: 20px auto;
}
.flashcard {
    width: 100%; height: 100%; position: relative; cursor: pointer;
    transition: transform 0.6s cubic-bezier(0.4, 0.2, 0.2, 1), opacity 0.4s;
    transform-style: preserve-3d;
}
.flashcard.is-flipped { transform: rotateY(180deg); }
.flashcard.swipe-left { transform: rotateY(180deg) translateX(-100px) rotate(-15deg); opacity: 0; }
.flashcard.swipe-right { transform: rotateY(180deg) translateX(100px) rotate(15deg); opacity: 0; }

.flashcard-face {
    position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
    border-radius: 30px; background: white; 
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    padding: 30px; border: 3px solid #f1f2f6; box-shadow: 0 15px 35px rgba(0,0,0,0.1);
}
.flashcard-front {
    background: linear-gradient(135deg, #ffffff 0%, #f1f2f6 100%);
}
.flashcard-back {
    transform: rotateY(180deg); 
    background: linear-gradient(135deg, #f8f9fa 0%, #e0eafc 100%);
    border-color: #a29bfe;
}
.fc-btn {
    width: 70px; height: 70px; border-radius: 50%; border: none; font-size: 2rem; 
    box-shadow: 0 10px 25px rgba(0,0,0,0.1); cursor: pointer; transition: 0.2s cubic-bezier(0.4, 0.2, 0.2, 1); 
    display:flex; justify-content:center; align-items:center; background: white;
}
.fc-btn:active { transform: scale(0.85); }
.fc-no { color: #ff7675; border: 3px solid #ff7675; }
.fc-yes { color: #00b894; border: 3px solid #00b894; }
.fc-hint { animation: pulse 1.5s infinite; color:#a29bfe; font-weight:bold; font-size: 0.95rem; margin-top: 15px; }
@keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
/* --- üèÜ LEADERBOARD STYLES --- */
.rank-item { 
    display: flex; align-items: center; padding: 15px 20px; border-radius: 20px; 
    margin-bottom: 12px; background: white; border: 2px solid #f1f2f6;
    box-shadow: 0 5px 15px rgba(0,0,0,0.02); transition: 0.3s;
}
.rank-item.is-user { 
    background: linear-gradient(135deg, var(--primary) 0%, #a29bfe 100%); 
    border-color: transparent; color: white; 
    box-shadow: 0 10px 25px rgba(108, 92, 231, 0.4); transform: scale(1.02);
}
.rank-item.is-user .rank-name { color: white !important; }
.rank-medal { font-size: 1.8rem; width: 45px; text-align: center; }
.rank-name { flex-grow: 1; font-weight: 800; font-size: 1.1rem; color: var(--text-main); }
.rank-score { font-weight: 900; font-size: 1.2rem; background: rgba(0,0,0,0.05); padding: 5px 12px; border-radius: 12px; }
.rank-item.is-user .rank-score { background: rgba(255,255,255,0.2); color: white; }
    </style>
</head>
<body>

    <audio id="snd-click" src="sounds/click.mp3" preload="auto"></audio>
    <audio id="snd-correct" src="sounds/collect.mp3" preload="auto"></audio>
    <audio id="snd-wrong" src="sounds/thud.mp3" preload="auto"></audio>
    <audio id="snd-win" src="sounds/win.mp3" preload="auto"></audio>

    <div class="container" id="main-container">
        <div id="screen-home" class="fade-in">
            
            <div class="app-header">
                <h1 class="app-title">Vocab Pro ‚ú®</h1>
                <div class="header-actions">
                    <button onclick="playSnd('snd-click'); openMistakes()">
                        <span>üìù</span> 
                        <span id="m-count" style="position: absolute; top: -2px; right: -2px; background: var(--danger); color: white; font-size: 0.65rem; width: 16px; height: 16px; border-radius: 50%; display: flex; justify-content: center; align-items: center; border: 2px solid white;">0</span>
                    </button>
                </div>
            </div>

            <div class="profile-card">
                <div class="profile-top">
                    <div class="profile-info">
                        <span class="rank-label">CURRENT RANK</span>
                        <h2 class="rank-name" id="rank-txt">üê£ ‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</h2>
                    </div>
                    <div class="profile-avatar" id="rank-avatar">üê£</div>
                </div>

                <div class="xp-wrapper">
                    <div class="xp-header">
                        <span id="next-rank-hint">NEXT: ‡∏ú‡∏π‡πâ‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î</span>
                        <span id="xp-val">0 / 50 XP</span>
                    </div>
                    <div id="ai-mentor-container" style="background: white; border-radius: 24px; padding: 22px; margin-bottom: 25px; border: 1px solid rgba(108, 92, 231, 0.1); box-shadow: 0 15px 35px rgba(0,0,0,0.05); position: relative; overflow: hidden; display: flex; align-items: center; gap: 18px; transition: all 0.3s ease;">
    <div style="position: absolute; top: -20px; right: -20px; width: 80px; height: 80px; background: rgba(108, 92, 231, 0.05); border-radius: 50%;"></div>
    
    <div style="position: relative; flex-shrink: 0;">
      <img src="image_0.png" alt="AI Mentor Avatar" onclick="openAIStats()" style="cursor: pointer; width: 52px; height: 52px; border-radius: 50%; object-fit: cover; z-index: 2; position: relative; border: 3px solid white; box-shadow: 0 4px 12px rgba(108, 92, 231, 0.25);">
        
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; background: var(--primary); opacity: 0.2; border-radius: 50%; animation: ai-pulse 2s infinite;"></div>
    </div>

    <div style="flex-grow: 1; z-index: 2;">
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
            <span style="background: var(--primary); color: white; font-size: 0.65rem; padding: 2px 8px; border-radius: 20px; font-weight: 800; letter-spacing: 0.5px;">AI MENTOR</span>
            <h3 id="ai-status-title" style="margin: 0; color: var(--primary-dark); font-size: 1.05rem; font-weight: 800; letter-spacing: -0.3px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤...</h3>
        </div>
        <p id="ai-daily-summary" style="margin: 0; font-size: 0.92rem; color: var(--text-sub); line-height: 1.5; font-weight: 500;">
            ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏Å‡πâ‡∏≤‡∏ß‡∏Ç‡πâ‡∏≤‡∏°‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡∏ô‡∏∞!
        </p>
        <div id="ai-action-btn" style="display: none; margin-top: 12px;">
            <button onclick="startReviewMode()" style="background: linear-gradient(135deg, var(--primary) 0%, #a29bfe 100%); border: none; padding: 8px 18px; border-radius: 12px; font-size: 0.82rem; font-weight: 700; color: white; cursor: pointer; box-shadow: 0 4px 12px rgba(108, 92, 231, 0.2); transition: transform 0.2s;">
                ‚öîÔ∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏°‡∏î‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏Ñ‡πâ‡∏ô
            </button>
        </div>
    </div>
</div>

<style>
@keyframes ai-pulse {
    0% { transform: translate(-50%, -50%) scale(0.85); opacity: 0.4; }
    100% { transform: translate(-50%, -50%) scale(1.4); opacity: 0; }
}
#ai-mentor-container:hover { transform: translateY(-2px); box-shadow: 0 20px 40px rgba(0,0,0,0.08); }
</style>
                    <div class="xp-track"><div class="xp-fill" id="xp-fill"></div></div>
                </div>

                <div class="stats-row">
                    <div class="stat-box">
                        <span class="stat-val" id="st-streak">0</span>
                        <span class="stat-label">üî• Streak</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-val" id="st-win">0%</span>
                        <span class="stat-label">‚ö° Level</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-val" id="st-total">0</span>
                        <span class="stat-label">üìö Words</span>
                    </div>
                </div>
            </div>

            <div class="badge-section">
                <span class="section-title">Achievements</span>
                <div class="badge-bar">
                    <div class="badge-item" id="b-play" onclick="playSnd('snd-click'); alert('üî∞ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡πâ‡∏≤‡∏ß‡πÅ‡∏£‡∏Å: ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á')">üî∞</div>
                    <div class="badge-item" id="b-cor" onclick="playSnd('snd-click'); alert('üî• ‡∏à‡πâ‡∏≤‡∏ß‡πÅ‡∏´‡πà‡∏á‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå: ‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏™‡∏∞‡∏™‡∏°‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å 50 ‡∏Ç‡πâ‡∏≠')">üî•<span class="mult" id="m-cor" style="display:none">x1</span></div>
                    <div class="badge-item" id="b-perf" onclick="playSnd('snd-click'); alert('üèÜ ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏ö‡∏ö: ‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å 100% ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏£‡∏≠‡∏ö')">üèÜ<span class="mult" id="m-perf" style="display:none">x1</span></div>
                    <div class="badge-item" id="b-xp" onclick="playSnd('snd-click'); alert('üëë ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á: ‡∏™‡∏∞‡∏™‡∏°‡∏Ñ‡∏£‡∏ö 300 XP')">üëë</div>
                    <div class="badge-item" id="b-streak" onclick="playSnd('snd-click'); alert('‚ö° ‡∏ô‡∏±‡∏Å‡∏™‡∏õ‡∏µ‡∏î‡∏£‡∏±‡∏ô: ‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á 10 ‡∏Ç‡πâ‡∏≠‡πÉ‡∏ô‡∏£‡∏≠‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß')">‚ö°</div>
                    <div class="badge-item" id="b-coll" onclick="playSnd('snd-click'); alert('üíé ‡∏ô‡∏±‡∏Å‡∏™‡∏∞‡∏™‡∏°: ‡∏°‡∏µ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏ô‡∏™‡∏°‡∏∏‡∏î‡∏à‡∏î‡∏Ñ‡∏£‡∏ö 10 ‡∏Ñ‡∏≥')">üíé</div>
                    <div class="badge-item" id="b-marathon" onclick="playSnd('snd-click'); alert('üõ°Ô∏è ‡∏°‡∏≤‡∏£‡∏≤‡∏ò‡∏≠‡∏ô: ‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏ö‡πÇ‡∏´‡∏°‡∏î 30 ‡∏Ç‡πâ‡∏≠')">üõ°Ô∏è</div>
                    <div class="badge-item" id="b-legend" onclick="playSnd('snd-click'); alert('üåå ‡∏ï‡∏≥‡∏ô‡∏≤‡∏ô: ‡∏™‡∏∞‡∏™‡∏°‡∏Ñ‡∏£‡∏ö 2,000 XP')">üåå</div>
                    <div class="badge-item" id="b-god" onclick="playSnd('snd-click'); alert('üßø ‡∏ï‡∏≤‡∏ó‡∏¥‡∏û‡∏¢‡πå: ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô 20 ‡∏Ç‡πâ‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ')">üßø</div>
                    <div class="badge-item" id="b-clean" onclick="playSnd('snd-click'); alert('üßπ ‡∏ô‡∏±‡∏Å‡∏Å‡∏ß‡∏≤‡∏î‡∏•‡πâ‡∏≤‡∏á: ‡∏•‡∏ö‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏™‡∏°‡∏∏‡∏î‡∏à‡∏î‡∏®‡∏±‡∏û‡∏ó‡πå‡∏à‡∏ô‡∏´‡∏°‡∏î')">üßπ</div>
                    <div class="badge-item" id="b-time" onclick="playSnd('snd-click'); alert('‚è≥ ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏Å‡∏≤‡∏•‡πÄ‡∏ß‡∏•‡∏≤: ‡∏à‡∏ö‡∏£‡∏≠‡∏ö‡πÇ‡∏î‡∏¢‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏•‡∏≠‡∏î')">‚è≥</div>
                    <div class="badge-item" id="b-king" onclick="playSnd('snd-click'); alert('üëë ‡∏£‡∏≤‡∏ä‡∏≤‡∏®‡∏±‡∏û‡∏ó‡πå: ‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏ö‡πÇ‡∏´‡∏°‡∏î ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏Ñ‡∏£‡∏ö 5 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á')">‚ú®</div>
                </div>
            </div>

            <div class="cat-wrapper" id="cat-select" onclick="toggleCat()">
                <div class="custom-select">
                    <span id="selected-cat">üî• ‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î</span>
                    <span style="color: #b2bec3;">‚ñº</span>
                </div>
                <div class="options-list" id="cat-list"></div>
            </div>

            <div class="game-menu">
                <div class="card-main-game" onclick="playSnd('snd-click'); showScreen('screen-mode')">
                    <div class="icon-box">üá¨üáß</div>
                    <div class="text-box">
                        <h3>‡∏ï‡∏¥‡∏ß‡∏®‡∏±‡∏û‡∏ó‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h3>
                        <p>‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô 4 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>
                    </div>
                    <div class="arrow">‚ûú</div>
                </div>

                <div class="mini-grid">
                    <div class="mini-card tf-card" onclick="startTFGame()">
                        <div class="mini-icon" style="color:var(--success)">‚ö°</div>
                        <div class="mini-label">‡πÉ‡∏ä‡πà/‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà</div>
                    </div>
                    <div class="mini-card vo-card" onclick="startVowelGame()">
                        <div class="mini-icon" style="color:var(--accent)">üß©</div>
                        <div class="mini-label">‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏£‡∏∞</div>
                    </div>
                    <div class="mini-card sen-card" onclick="startSentenceGame()">
                        <div class="mini-icon" style="color:#0984e3">üìù</div>
                        <div class="mini-label">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ</div>
                    </div>
                    <div class="mini-card" onclick="startFlashcardMode()">
                        <div class="mini-icon" style="color:#9b59b6">üÉè</div>
                        <div class="mini-label">‡πÅ‡∏ü‡∏•‡∏ä‡∏Å‡∏≤‡∏£‡πå‡∏î</div>
                    </div>
                    <div class="mini-card" onclick="openLeaderboard()">
                        <div class="mini-icon" style="color:#e1b12c">üèÜ</div>
                        <div class="mini-label">‡∏à‡∏±‡∏î‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</div>
                    </div>
                    <div class="mini-card" style="background:#f5f6fa;" onclick="playSnd('snd-click'); alert('Coming Soon!')">
                        <div class="mini-icon" style="filter:grayscale(1); opacity:0.3;">üîí</div>
                        <div class="mini-label" style="color:#b2bec3;">‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ</div>
                    </div>
                </div>
            </div>

            <div class="footer-reset">
                <button onclick="playSnd('snd-click'); if(confirm('‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) {localStorage.clear(); location.reload();}">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏°</button>
            </div>
        </div>

        <div id="screen-mode" class="hidden">
            <h3 style="margin: 0 0 20px; color: var(--primary-dark); font-size: 1.3rem;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</h3>
            <div style="display:flex; flex-direction:column; gap:12px;">
                <button class="choice-btn" style="padding: 15px; box-shadow:none; justify-content: flex-start; gap: 15px;" onclick="playSnd('snd-click'); startGame(10)">
                    <span style="font-size: 1.2rem;">üéØ</span> 10 ‡∏Ç‡πâ‡∏≠ (‡πÄ‡∏£‡πá‡∏ß)
                </button>
                <button class="choice-btn" style="padding: 15px; box-shadow:none; justify-content: flex-start; gap: 15px;" onclick="playSnd('snd-click'); startGame(20)">
                    <span style="font-size: 1.2rem;">üéØ</span> 20 ‡∏Ç‡πâ‡∏≠ (‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏µ)
                </button>
                <button class="choice-btn" style="padding: 15px; box-shadow:none; justify-content: flex-start; gap: 15px;" onclick="playSnd('snd-click'); startGame(30)">
                    <span style="font-size: 1.2rem;">üéØ</span> 30 ‡∏Ç‡πâ‡∏≠ (‡πÄ‡∏ô‡πâ‡∏ô‡πÜ)
                </button>
                <button class="choice-btn" style="padding: 15px; box-shadow:none; border-color: var(--danger); color: var(--danger); justify-content: flex-start; gap: 15px;" onclick="playSnd('snd-click'); startGame(0)">
                    <span style="font-size: 1.2rem;">üî•</span> ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏°‡∏≤‡∏£‡∏≤‡∏ò‡∏≠‡∏ô)
                </button>
            </div>
            <button onclick="playSnd('snd-click'); showScreen('screen-home')" style="margin-top:25px; border:none; background:none; color:#b2bec3; font-weight: bold; cursor: pointer; font-size: 1rem;">‚úï ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>

        <div id="screen-game" class="hidden">
         <div id="combo-normal" style="position:absolute; top:10px; left:0; right:0; margin:auto; width:fit-content; z-index:10;"></div>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 15px;">
                <button onclick="playSnd('snd-click'); location.reload()" style="background:#f1f2f6; border:none; padding:8px 15px; border-radius:12px; font-weight: bold; cursor: pointer; color: var(--text-sub); font-size: 0.9rem;">üè† ‡∏≠‡∏≠‡∏Å</button>
                <div id="score-txt" style="font-weight:900; color:var(--primary); font-size: 1.1rem;">Score: 0</div>
            </div>
            
            <button id="btn-5050" style="width:100%; padding:10px; border:2px solid var(--accent); color:var(--accent); background: white; border-radius:12px; font-weight:bold; cursor:pointer; margin-bottom:15px; font-size: 1rem;" onclick="use5050()">‚ö° ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢ 50/50</button>
            
            <div class="question-box">
               <div id="combo-vo" style="position:absolute; top:-15px; left:10px; z-index:10;"></div>
                <div id="prog-txt" style="position:absolute; top:10px; right:15px; font-weight: bold; color: #b2bec3; font-size: 0.9rem;">1/10</div>
                <div class="word-en" id="q-word">Word</div>
                <div class="word-read" id="q-read" style="font-size: 1rem; color: #636e72; font-style: italic; margin-top: 5px;">/ Reading /</div>
                <div class="timer-bar" id="t-bar" style="position: absolute; bottom: 0; left: 0; height: 6px; background: var(--accent); width: 100%; border-radius: 0 0 20px 20px;"></div>
            </div>
            <div class="choices-grid" id="choices-area"></div>
            <button id="btn-next" class="next-btn hidden" onclick="playSnd('snd-click'); nextQ()">‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ ‚ûú</button>
        </div>

<div id="screen-tf" class="hidden">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 10px;">
        <button onclick="playSnd('snd-click'); location.reload()" style="background:#f1f2f6; border:none; padding:8px 15px; border-radius:12px; font-weight: bold; cursor: pointer; color: var(--text-sub);">üè† ‡∏≠‡∏≠‡∏Å</button>
        <div id="tf-score-txt" style="font-weight:900; color:var(--primary); font-size: 1.1rem;">Score: 0</div>
    </div>
    
    <div class="life-bar" id="tf-life" style="margin-bottom:10px; font-size:1.4rem;">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
    
    <p style="color:#b2bec3; font-size:0.9rem; margin-bottom:10px;">‡∏õ‡∏±‡∏î‡∏Ç‡∏ß‡∏≤ = ‡πÉ‡∏ä‡πà ‚úÖ / ‡∏õ‡∏±‡∏î‡∏ã‡πâ‡∏≤‡∏¢ = ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà ‚ùå</p>

    <div class="tinder-container">
        <div id="tf-card" class="tinder-card">
           <div id="combo-tf" style="position:absolute; top:15px; left:15px; z-index:100;"></div>
            <div class="swipe-status status-yes" id="txt-yes">YES</div>
            <div class="swipe-status status-no" id="txt-no">NOPE</div>

            <div class="word-en" id="tf-word" style="margin-bottom: 15px; font-size: 2.2rem;">Word</div>
            <div style="font-size: 1rem; color: #b2bec3; margin-bottom: 15px;">‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤...</div>
            <div class="word-en" id="tf-mean" style="font-size: 1.8rem; color: var(--text-main);">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢</div>
            
            <div class="timer-bar" id="tf-bar" style="position: absolute; bottom: 0; left: 0; height: 8px; background: var(--danger); width: 100%; border-radius: 0 0 20px 20px;"></div>
        </div>
    </div>

    <div class="tinder-controls">
        <button class="control-btn btn-no" onclick="manualSwipe('left')">‚ùå</button>
        <button class="control-btn btn-yes" onclick="manualSwipe('right')">‚úÖ</button>
    </div>
</div>
        <div id="screen-vowel" class="hidden">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 15px;">
                <button onclick="playSnd('snd-click'); location.reload()" style="background:#f1f2f6; border:none; padding:8px 15px; border-radius:12px; font-weight: bold; cursor: pointer; color: var(--text-sub); font-size: 0.9rem;">üè† ‡∏≠‡∏≠‡∏Å</button>
                <div id="vo-score-txt" style="font-weight:900; color:var(--primary); font-size: 1.1rem;">Score: 0</div>
            </div>
            <div class="life-bar" id="vo-life" style="margin-bottom:15px; font-size:1.4rem;">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
            <div class="question-box" style="padding: 30px 10px;">
                <div id="combo-vo" style="position:absolute; top:10px; left:0; right:0; margin:auto; width:fit-content; z-index:10;"></div>
                <div style="font-size: 1rem; color: #b2bec3;">‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏£‡∏∞‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏¢‡πÑ‡∏õ</div>
                <div class="word-en" id="vo-word" style="font-size: 2.2rem; letter-spacing: 3px; margin: 15px 0;">W_RD</div>
                <div class="word-read" id="vo-mean" style="font-size: 1.1rem; color: var(--text-main);">(‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢)</div>
                <div class="timer-bar" id="vo-bar" style="position: absolute; bottom: 0; left: 0; height: 6px; background: var(--primary); width: 100%; border-radius: 0 0 20px 20px;"></div>
            </div>
            <div class="vowel-grid" id="vo-choices"></div>
        </div>

        <div id="screen-sentence" class="hidden">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 15px;">
                <button onclick="playSnd('snd-click'); location.reload()" style="background:#f1f2f6; border:none; padding:8px 15px; border-radius:12px; font-weight: bold; cursor: pointer; color: var(--text-sub); font-size: 0.9rem;">üè† ‡∏≠‡∏≠‡∏Å</button>
                <div id="sen-score-txt" style="font-weight:900; color:var(--primary); font-size: 1.1rem;">Score: 0</div>
            </div>
            <div class="life-bar" id="sen-life" style="margin-bottom:15px; font-size:1.4rem;">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>

            <div class="question-box" style="padding: 30px 15px;">
                <div id="combo-sen" style="position:absolute; top:-15px; left:10px; z-index:10;"></div>
                <div style="font-size: 1rem; color: #b2bec3;">‡∏à‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</div>
                <div class="word-en" id="sen-mean" style="font-size: 1.3rem; margin-top:10px; color:var(--text-main);">‡∏â‡∏±‡∏ô ‡πÑ‡∏õ ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
            </div>

            <div id="sen-answer-area" class="sentence-box">
                <span style="color:#bdc3c7; font-size:0.9rem;">(‡πÅ‡∏ï‡∏∞‡∏Ñ‡∏≥‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏á)</span>
            </div>
            
            <div id="sen-feedback" class="hidden" style="margin: 15px 0; padding: 10px; background: #fff3cd; border: 1px solid #ffeeba; border-radius: 12px; color: #856404; font-size: 1rem;"></div>

            <button id="sen-check-btn" class="next-btn hidden" style="margin: 15px 0; background: var(--success); box-shadow: 0 5px 15px rgba(0, 184, 148, 0.4);" onclick="checkSentence()">‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
            <button id="sen-next-btn" class="next-btn hidden" style="margin: 15px 0;" onclick="playSnd('snd-click'); nextSentenceQ()">‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ ‚ûú</button>

            <div id="sen-choices" class="sentence-choices" style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-top: 15px;"></div>
        </div>
        <div id="leaderboard-modal" class="modal-overlay hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); z-index: 10000; display: flex; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box;">
        <div style="background:#f8f9fa; padding:30px; border-radius:30px; width:100%; max-width:450px; max-height: 85vh; overflow-y: auto; position:relative; box-shadow: 0 25px 60px rgba(0,0,0,0.3); text-align: center;">
            <button onclick="closeLeaderboard()" style="position:absolute; top:20px; right:20px; background:white; border:none; width:40px; height:40px; border-radius:50%; font-size:1.5rem; cursor:pointer; color:var(--text-sub); transition: 0.2s; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">‚úï</button>
            
            <div style="margin-bottom: 25px;">
                <span style="font-size: 4rem; filter: drop-shadow(0 5px 10px rgba(225, 177, 44, 0.3));">üèÜ</span>
                <h2 style="margin: 10px 0 5px 0; color: var(--primary-dark); font-size: 1.8rem;">Leaderboard</h2>
                <p style="margin: 0; color: #b2bec3; font-size: 0.95rem; font-weight:bold;">‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÄ‡∏Å‡πá‡∏ö XP (‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏ö‡∏≠‡∏ó‡∏ó‡∏∏‡∏Å 2 ‡∏ô‡∏≤‡∏ó‡∏µ)</p>
            </div>
            
            <div id="lb-list" style="text-align: left; margin-top: 20px;">
                </div>
            
            <button class="next-btn" onclick="closeLeaderboard()" style="width: 100%; margin-top: 20px; padding: 15px; font-size: 1.1rem; border-radius: 20px;">‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏•‡∏∏‡∏¢‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏ï‡πâ‡∏°!</button>
        </div>
    </div>
       <div id="screen-flashcard" class="hidden">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 15px;">
                <button onclick="playSnd('snd-click'); location.reload()" style="background:#f1f2f6; border:none; padding:10px 18px; border-radius:16px; font-weight: bold; cursor: pointer; color: var(--text-sub); font-size: 0.95rem;">üè† ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
                <div style="text-align: right;">
                    <div id="fc-progress-txt" style="font-weight:900; color:var(--primary); font-size: 1.1rem;">1 / 20</div>
                </div>
            </div>
            
            <div style="background: #dfe6e9; height: 8px; border-radius: 4px; overflow: hidden; margin-bottom: 20px;">
                <div id="fc-progress-bar" style="background: var(--primary); width: 5%; height: 100%; transition: width 0.3s;"></div>
            </div>

            <div class="flashcard-container">
                <div id="fc-card" class="flashcard" onclick="flipCard()">
                    <div class="flashcard-face flashcard-front">
                       <span style="font-size: 2rem; margin-bottom: 10px; filter: drop-shadow(0 5px 7px rgba(0,0,0,0.1));">‚ùì</span>
                        <div class="word-en" id="fc-word-en" style="font-size: 2.8rem; text-align: center; color: var(--text-main); font-weight: 800;">Word</div>
                        <div class="fc-hint">ü™Ñ Tap to flip ‚ú®</div>
                    </div>
                    <div class="flashcard-face flashcard-back">
                        <span style="font-size: 2.2rem; margin-bottom: 12px; opacity: 0.8;">üí°</span>
                        <div class="word-en" id="fc-word-th" style="font-size: 1.8rem; color: var(--primary-dark); text-align: center; font-weight: 800; line-height: 1.4; padding: 0 10px;">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢</div>
                        <div class="word-read" id="fc-word-read" style="margin-top: 18px; font-size: 1.1rem; color: #636e72; background: white; padding: 6px 18px; border-radius: 14px; border: 2px dashed #dfe6e9; font-family: monospace;">/ read /</div>
                    </div>
                 </div>
            </div>

            <div class="fc-controls" id="fc-controls" style="opacity: 0.3; pointer-events: none; transition: 0.3s; margin-top: 30px; display:flex; justify-content:center; gap:40px;">
                <div style="display:flex; flex-direction:column; align-items:center; gap:10px;">
                    <button class="fc-btn fc-no" onclick="swipeFlashcard(false)">‚ùå</button>
                    <span style="font-size:0.85rem; font-weight:bold; color:#ff7675;">‡∏à‡∏≥‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡∏ß‡∏ô‡πÉ‡∏´‡∏°‡πà)</span>
                </div>
                <div style="display:flex; flex-direction:column; align-items:center; gap:10px;">
                    <button class="fc-btn fc-yes" onclick="swipeFlashcard(true)">‚úÖ</button>
                    <span style="font-size:0.85rem; font-weight:bold; color:#00b894;">‡∏à‡∏≥‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß (‡∏ú‡πà‡∏≤‡∏ô)</span>
                </div>
            </div>
        </div>
        
        <div id="screen-end" class="hidden">
            <h2 id="end-msg" style="font-size: 1.8rem; margin-bottom: 10px;">‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏ß! üéâ</h2>
            <div id="stars" style="font-size:4rem; margin-bottom:15px; letter-spacing: 5px;"></div>
            <h1 id="f-score" style="margin:0; font-size: 3rem; color: var(--primary);">0</h1>
            <p style="color:#b2bec3; margin:0 0 20px; font-size: 1rem;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</p>
            
            <p id="bonus-notif" style="color: var(--accent); font-weight: bold; height: 20px; font-size: 1rem;"></p>
            <p id="streak-summary" style="color: #636e72; font-size: 1rem; margin-top: 5px;"></p>
           <div id="ai-postgame-container" style="background: #f8f9fa; border-radius: 20px; padding: 15px; margin: 20px auto 0; text-align: left; border: 2px dashed #dfe6e9; display: flex; align-items: center; gap: 15px; max-width: 90%;">
                <img src="image_0.png" style="width: 50px; height: 50px; border-radius: 50%; border: 2px solid var(--primary); object-fit: cover; flex-shrink: 0;">
                <div>
                    <span style="font-size: 0.75rem; font-weight: 800; color: var(--primary); letter-spacing: 0.5px;">‡πÅ‡∏û‡∏ó‡∏£‡∏¥‡∏Ñ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÉ‡∏´‡πâ‡∏ü‡∏±‡∏á üåü</span>
                    <p id="ai-postgame-msg" style="margin: 5px 0 0; font-size: 0.95rem; color: var(--text-main); font-weight: 600; line-height: 1.4;"></p>
                </div>
            </div>
            <button class="next-btn" onclick="playSnd('snd-click'); location.reload()" style="margin-top: 30px;">üîÑ ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>            
        </div>
    </div>

<div id="ai-stats-modal" class="modal-overlay hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); z-index: 10000; display: flex; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box;">
        <div style="background:white; padding:30px; border-radius:30px; width:100%; max-width:650px; max-height: 90vh; overflow-y: auto; position:relative; box-shadow: 0 25px 60px rgba(0,0,0,0.3); text-align: center;">
            <button onclick="closeAIStats()" style="position:absolute; top:20px; right:20px; background:#f1f2f6; border:none; width:40px; height:40px; border-radius:50%; font-size:1.5rem; cursor:pointer; color:var(--text-sub); transition: 0.2s;">‚úï</button>
            
            <div style="display:flex; align-items:center; gap:20px; margin-bottom: 25px; text-align:left;">
                <img src="image_0.png" style="width: 75px; height: 75px; border-radius: 50%; border: 4px solid var(--primary); object-fit: cover; box-shadow: 0 4px 15px rgba(108, 92, 231, 0.2);">
                <div>
                    <h3 style="color: var(--primary-dark); margin: 0; font-size: 1.5rem;">Patrick AI</h3>
                    <p style="margin: 0; font-size: 1rem; color: var(--text-sub); font-weight: 600;">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏≠‡∏ö</p>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                
                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #f1f2f6 100%); border-radius: 20px; padding: 20px; border: 1px solid #dfe6e9; text-align: left; display: flex; flex-direction: column; justify-content: center;">
                    <div style="display:flex; justify-content:space-between; align-items:end; margin-bottom:12px;">
                        <span style="font-weight: 800; color: var(--text-main); font-size: 1.1rem;">üìö ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå</span>
                        <span id="ai-ready-pct" style="font-size: 2rem; font-weight: 900; color: var(--success); line-height: 1;">0%</span>
                    </div>
                    <div style="background: #dfe6e9; height: 15px; border-radius: 10px; overflow: hidden; margin-bottom: 12px;">
                        <div id="ai-ready-bar" style="background: var(--success); width: 0%; height: 100%; transition: width 1s cubic-bezier(0.4, 0, 0.2, 1); border-radius: 10px;"></div>
                    </div>
                    <p id="ai-ready-text" style="margin: 0; font-size: 0.95rem; color: var(--text-sub); font-weight: 600;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
                </div>

                <div style="background: white; border-radius: 20px; padding: 20px; border: 1px solid #dfe6e9; text-align: left; box-shadow: 0 4px 15px rgba(0,0,0,0.02);">
                    <span style="font-weight: 800; color: var(--text-main); font-size: 1.1rem; display:block; margin-bottom:15px;">üìä ‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏¥‡∏ß‡∏™‡∏∞‡∏™‡∏°</span>
                    <div id="ai-chart-area" style="display:flex; justify-content:space-between; align-items:flex-end; height: 100px; padding-bottom: 5px; border-bottom: 2px dashed #f1f2f6;">
                        </div>
                    <div id="ai-chart-labels" style="display:flex; justify-content:space-between; margin-top: 10px; font-size: 0.8rem; color: #b2bec3; font-weight: bold;">
                        </div>
                </div>
            </div>

            <div style="background: #fff0f0; border-radius: 20px; padding: 20px; margin-top: 20px; text-align: left; border: 1px dashed var(--danger);">
                <p style="margin: 0 0 10px 0; font-size: 1.1rem; color: var(--danger); font-weight: bold;">
                    üéØ ‡πÄ‡∏£‡∏î‡∏≤‡∏£‡πå‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô (‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏µ‡πà‡∏û‡∏•‡∏≤‡∏î‡∏ö‡πà‡∏≠‡∏¢)
                </p>
                <div id="ai-weakness-radar" style="font-size: 0.95rem; color: var(--text-main); background: white; padding: 15px; border-radius: 15px; border: 1px solid #fbeeb8;">
                    </div>
            </div>
            
            <button class="next-btn" onclick="closeAIStats()" style="width: 100%; margin-top: 20px; padding: 15px; font-size: 1.1rem; border-radius: 20px;">‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö ‡∏•‡∏∏‡∏¢‡∏ï‡πà‡∏≠!</button>
        </div>
    </div>
    <div id="m-modal" class="modal-overlay hidden">
        <div style="background:white; padding:25px; border-radius:20px; width:90%; max-width:400px; max-height:70vh; overflow-y:auto; position: relative; box-shadow: 0 20px 50px rgba(0,0,0,0.2);">
            <h3 style="color: var(--danger); margin-top: 0; display:flex; align-items:center; gap:10px;">
                <span style="font-size:1.5rem;">üìù</span> ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏ô‡πâ‡∏ô
            </h3>
            
            <button id="btn-revenge" class="next-btn" onclick="startReviewMode()" style="background: var(--danger); margin-bottom: 15px; display:none; box-shadow: 0 4px 15px rgba(255, 118, 117, 0.4);">
                ‚öîÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏Ñ‡πâ‡∏ô (‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î)
            </button>

            <div id="m-list" style="text-align: left; margin-top: 15px;"></div>
            
            <button class="next-btn" style="margin-top:20px; background: #dfe6e9; color: var(--text-main); box-shadow:none;" onclick="playSnd('snd-click'); document.getElementById('m-modal').classList.add('hidden')">
                ‡∏õ‡∏¥‡∏î‡∏™‡∏°‡∏∏‡∏î
            </button>
        </div>
    </div>
    
    <script src="words.js"></script>
    <script src="verbs3.js"></script>
    <script src="sentences.js"></script>
    <script src="adjectives.js"></script>
    <script src="nouns.js"></script>
    <script src="pronouns.js"></script>

    <script>
        let isReviewMode = false;
        // --- üîó ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ---
        if (typeof vocabDatabase === 'undefined') { window.vocabDatabase = []; }
        if (typeof irregularVerbs !== 'undefined') { vocabDatabase.push(...irregularVerbs); }
        if (typeof sentenceDB === 'undefined') { window.sentenceDB = [{en:"Test sentence", th:"‡∏ó‡∏î‡∏™‡∏≠‡∏ö", level:"easy"}]; }

        // --- Data ---
        const ranks = [
            {xp:0, t:"üê£ ‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô", c:"#ecf0f1", icon:"üê£"}, 
            {xp:800, t:"‚úèÔ∏è ‡∏ú‡∏π‡πâ‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î", c:"#bdc3c7", icon:"‚úèÔ∏è"},
            {xp:1200, t:"üìö ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏î‡∏µ‡πÄ‡∏î‡πà‡∏ô", c:"#3498db", icon:"üìö"}, 
            {xp:2500, t:"üéì ‡∏õ‡∏£‡∏°‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå", c:"#f1c40f", icon:"üéì"},
            {xp:6000, t:"üëë ‡πÄ‡∏ó‡∏û‡πÄ‡∏à‡πâ‡∏≤‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå", c:"#e67e22", icon:"üëë"}, 
            {xp:8000, t:"üßô ‡πÄ‡∏ã‡∏µ‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤", c:"#9b59b6", icon:"üßô"},
            {xp:12000, t:"üåå ‡∏à‡∏≠‡∏°‡∏à‡∏±‡∏Å‡∏£‡∏û‡∏£‡∏£‡∏î‡∏¥", c:"#1abc9c", icon:"üåå"}, 
            {xp:25000, t:"üöÄ ‡∏ï‡∏≥‡∏ô‡∏≤‡∏ô‡πÑ‡∏£‡πâ‡∏û‡πà‡∏≤‡∏¢", c:"#e74c3c", icon:"üöÄ"}
        ];

        let tXP = parseInt(localStorage.getItem('tXP'))||0, 
            tCor = parseInt(localStorage.getItem('tCor'))||0, 
            tPerf = parseInt(localStorage.getItem('tPerf'))||0, 
            mistakes = JSON.parse(localStorage.getItem('vMis'))||[],
            maxStreak = parseInt(localStorage.getItem('maxStreak'))||0,
            hasPlayed30 = localStorage.getItem('hasPlayed30') === 'true',
            hasCleaned = localStorage.getItem('hasCleaned') === 'true',
            allModeCount = parseInt(localStorage.getItem('allModeCount'))||0,
            perfectTimeCount = parseInt(localStorage.getItem('perfectTimeCount'))||0;
        
        let qs = [], qIdx = 0, score = 0, isAns = false, tInt, fUsed = false, corInRound = 0, selCat = 'all';
        let currentStreak = 0;

        let tfLives = 3, tfScore = 0, tfCorrect = false, tfInt;
        let voLives = 3, voScore = 0, voCorrect = '', voInt;

        window.onload = () => { updateUI(); updateAIMentorHome(); genCats(); };

        // Helper
        function setTxt(id, txt) { const el = document.getElementById(id); if(el) el.innerText = txt; }
        function playSnd(id) { const s = document.getElementById(id); if(s) { s.pause(); s.currentTime = 0; s.play().catch(()=>{}); } }
        
        // --- üöÄ Optimized Show Screen ---
        function showScreen(id) { 
            // Hide all first
            document.querySelectorAll('.container > div').forEach(s => {
                if (!s.classList.contains('hidden')) {
                    s.classList.add('hidden');
                    s.classList.remove('fade-in'); // Reset animation
                }
            }); 
            
            // Show new one with Animation
            const next = document.getElementById(id);
            next.classList.remove('hidden'); 
            next.classList.add('fade-in'); // Trigger Fade In
            
            if(id==='screen-home') updateUI(); 
        }

        function toggleCat() { playSnd('snd-click'); document.getElementById('cat-select').classList.toggle('open'); }

        function genCats() {
            const area = document.getElementById('cat-list'); 
            // üî• Check if already generated to prevent stutter
            if(area && area.children.length > 0) return;

           const cats = [
    {v:'all', t:'üî• ‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î'}, 
    {v:'verbs3', t:'‚ö° ‡∏Å‡∏£‡∏¥‡∏¢‡∏≤ 3 ‡∏ä‡πà‡∏≠‡∏á'},
    {v:'sen-easy', t:'üå± ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ: ‡∏á‡πà‡∏≤‡∏¢ (Easy)'},
    {v:'sen-medium', t:'üåø ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ: ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (Medium)'},
    {v:'sen-hard', t:'üå≥ ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ: ‡∏¢‡∏≤‡∏Å (Hard)'},
    {v:'body', t:'üëÄ ‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢'}, {v:'home', t:'üè† ‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ö‡πâ‡∏≤‡∏ô'},
    {v:'clothing', t:'üëï ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤'}, {v:'feelings', t:'üòä ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å'}, {v:'food', t:'üçî ‡∏≠‡∏≤‡∏´‡∏≤‡∏£'},
    {v:'family', t:'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß'}, {v:'school', t:'üè´ ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'}, {v:'places', t:'üèôÔ∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà'},
    {v:'action', t:'üèÉ‚Äç‚ôÇÔ∏è ‡∏Ñ‡∏≥‡∏Å‡∏£‡∏¥‡∏¢‡∏≤'}, {v:'jobs', t:'üëÆ ‡∏≠‡∏≤‡∏ä‡∏µ‡∏û'}, {v:'description', t:'üìè ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞'},
    {v:'animal', t:'üê∂ ‡∏™‡∏±‡∏ï‡∏ß‡πå'}, {v:'vehicle', t:'üöó ‡∏¢‡∏≤‡∏ô‡∏û‡∏≤‡∏´‡∏ô‡∏∞'}, {v:'color', t:'üé® ‡∏™‡∏µ/‡∏ó‡∏£‡∏á'},
    {v:'time', t:'üìÖ ‡∏ß‡∏±‡∏ô/‡πÄ‡∏ß‡∏•‡∏≤'}, {v:'sports', t:'‚öΩ ‡∏Å‡∏µ‡∏¨‡∏≤'},{ v: 'hobby', t: 'üß∏ ‡∏á‡∏≤‡∏ô‡∏≠‡∏î‡∏¥‡πÄ‡∏£‡∏Å' }, {v:'fruits', t:'üçè ‡∏ú‡∏•‡πÑ‡∏°‡πâ/‡∏ú‡∏±‡∏Å'},
    {v:'nature', t:'‚õàÔ∏è ‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥'}, {v:'technology', t:'üíª ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ'}, {v:'grammar', t:'üó£Ô∏è ‡πÑ‡∏ß‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå'},
    {v:'personality', t:'üé≠ ‡∏ô‡∏¥‡∏™‡∏±‡∏¢'}, {v:'shopping', t:'üõçÔ∏è ‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á'}, {v:'education', t:'üéì ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤'},
    {v:'health', t:'üè• ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û'}, {v:'travel', t:'‚úàÔ∏è ‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß'}, {v:'law', t:'‚öñÔ∏è ‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢'},
    {v:'space', t:'üåå ‡∏≠‡∏ß‡∏Å‡∏≤‡∏®'}, {v:'environment', t:'‚ôªÔ∏è ‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°'}, 
    {v:'tools', t:'üõ†Ô∏è ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠'}, // <--- ‡πÅ‡∏Å‡πâ‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö
    { v: 'fantasy_creature', t: 'üêâ ‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÉ‡∏ô‡∏ï‡∏≥‡∏ô‡∏≤‡∏ô' },
    {v:'materials', t:'‚õìÔ∏è ‡∏ß‡∏±‡∏™‡∏î‡∏∏'}, {v:'phrasal_verb', t:'üî• ‡∏Å‡∏£‡∏¥‡∏¢‡∏≤‡∏ß‡∏•‡∏µ (Phrasal Verbs)'},
    { v: 'slang', t: 'üëæ ‡πÅ‡∏™‡∏•‡∏á' },{ v: 'military', t: 'ü™ñ ‡∏Å‡∏≤‡∏£‡∏ó‡∏´‡∏≤‡∏£' }, {v:'idioms', t:'üí¨ ‡∏™‡∏≥‡∏ô‡∏ß‡∏ô (Idioms)'},{ v: 'basic', t: 'üë§ ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (Basic)' }
];
            
            if(area) { 
                area.innerHTML = ''; 
                cats.forEach(c => { 
                    const d = document.createElement('div'); 
                    d.className = 'opt-item'; 
                    d.innerText = c.t; 
                    d.onclick = (e) => { 
                        playSnd('snd-click'); 
                        selCat = c.v;
                        document.getElementById('selected-cat').innerText = c.t; 
                        e.stopPropagation(); 
                        document.getElementById('cat-select').classList.remove('open'); 
                    }; 
                    area.appendChild(d); 
                }); 
            }
        }

        function updateUI() {
            let cur = ranks[0], nxt = ranks[1];
            ranks.forEach((r, i) => { if (tXP >= r.xp) { cur = r; nxt = ranks[i+1] || r; } });
            
            setTxt('rank-txt', cur.t);
            const av = document.getElementById('rank-avatar'); if(av && cur.icon) av.innerText = cur.icon;
            
            const xpFill = document.getElementById('xp-fill'); 
            if(xpFill) xpFill.style.width = Math.min(((tXP-cur.xp)/(nxt.xp-cur.xp||1))*100, 100) + '%';
            
            setTxt('xp-val', `${tXP} / ${nxt.xp} XP`);
            setTxt('next-rank-hint', `NEXT: ${nxt.t}`);
            setTxt('m-count', mistakes.length);
            setTxt('st-streak', maxStreak);
            setTxt('st-total', tCor); 
            setTxt('st-win', (tXP > 0 ? Math.floor(tXP/10) : 0)); 

            const checkBadge = (id, cond) => { const el = document.getElementById(id); if(el && cond) el.classList.add('active'); };
            if(tXP > 0) checkBadge('b-play', true);
            if(tCor >= 50) { checkBadge('b-cor', true); const mc = document.getElementById('m-cor'); if(mc){ mc.style.display='block'; mc.innerText = 'x'+Math.floor(tCor/50); } }
            if(tPerf >= 1) { checkBadge('b-perf', true); const mp = document.getElementById('m-perf'); if(mp){ mp.style.display='block'; mp.innerText = 'x'+tPerf; } }
            checkBadge('b-xp', tXP >= 300); checkBadge('b-streak', maxStreak >= 10); checkBadge('b-god', maxStreak >= 20);
            checkBadge('b-coll', mistakes.length >= 10); checkBadge('b-marathon', hasPlayed30); checkBadge('b-legend', tXP >= 2000);
            checkBadge('b-clean', hasCleaned); checkBadge('b-time', perfectTimeCount > 0); checkBadge('b-king', allModeCount >= 5);
        }
        // --- üí¨ ‡∏Ñ‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏û‡∏π‡∏î AI ‡πÄ‡∏ä‡∏µ‡∏¢‡∏£‡πå‡∏™‡∏î‡πÉ‡∏ô‡πÄ‡∏Å‡∏° ---
const aiCoachMsgs = {
    wrong: [
        "‡πÇ‡∏î‡∏ô‡∏´‡∏•‡∏≠‡∏Å‡∏ã‡∏∞‡πÅ‡∏•‡πâ‡∏ß! ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£‡∏Ñ‡∏£‡∏±‡∏ö",
        "‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏ñ‡∏≠‡∏ô‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏ô‡∏∞! ‡∏ú‡∏¥‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏≥",
        "‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ‡∏¢‡∏≤‡∏Å‡∏à‡∏£‡∏¥‡∏á‡∏Ñ‡∏£‡∏±‡∏ö ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏¢ ‡πÅ‡∏ï‡πà‡∏ú‡∏°‡∏à‡∏î‡∏•‡∏á‡∏™‡∏°‡∏∏‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞",
        "‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ‡∏°‡∏±‡∏ô‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ô‡∏°‡∏≤‡∏Å ‡∏Ñ‡∏£‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏•‡∏≤‡∏î‡πÅ‡∏ô‡πà",
        "‡∏û‡∏•‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πà‡∏á ‡∏•‡∏∏‡∏¢‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡πÄ‡∏•‡∏¢!"
    ],
    correct: [
        "‡πÄ‡∏â‡∏µ‡∏¢‡∏ö! ‡∏ï‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏Ñ‡∏£‡∏±‡∏ö",
        "‡∏°‡∏≤‡∏ñ‡∏π‡∏Å‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏•‡πá‡∏Å‡∏ú‡∏™‡∏°‡∏ô‡πâ‡∏≠‡∏¢‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÅ‡∏´‡∏•‡∏∞‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏Å‡∏™‡∏∏‡∏î",
        "‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î! ‡∏™‡∏°‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏®‡∏±‡∏û‡∏ó‡πå‡πÑ‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞",
        "‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å‡∏Ñ‡∏£‡∏±‡∏ö",
        "‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ10/10 ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡πá‡∏ö‡∏ô‡∏¥‡πà‡∏°‡∏Ñ‡∏£‡∏±‡∏ö",
        "‡πÉ‡∏ä‡πà‡πÄ‡∏•‡∏¢! ‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ‡∏ñ‡πâ‡∏≤‡πÄ‡∏à‡∏≠‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≠‡∏ö‡∏Å‡πá‡∏Å‡∏¥‡∏ô‡∏ô‡∏¥‡πà‡∏°‡∏Ñ‡∏£‡∏±‡∏ö"
    ],
    combo: [
        "üî• ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß! ‡∏™‡∏°‡∏≤‡∏ò‡∏¥‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‡∏•‡∏∏‡∏¢‡∏ï‡πà‡∏≠‡πÄ‡∏•‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô!",
        "üöÄ ‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á! ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏¥‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÅ‡∏´‡∏•‡∏∞‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏™‡∏≠‡∏ö!",
        "‚ö° ‡πÄ‡∏ó‡∏û‡∏à‡∏±‡∏î! ‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏ï‡∏¥‡∏î‡πÜ ‡∏Å‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ ‡πÄ‡∏≠‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏õ‡πÄ‡∏•‡∏¢‡πÑ‡∏´‡∏°?"
    ]
};

let coachTimeout;
function showAICoach(type, combo = 0) {
    let msgList = aiCoachMsgs[type];
    
    // ‡∏ñ‡πâ‡∏≤‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô 3 ‡∏Ç‡πâ‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ä‡∏°‡πÅ‡∏ö‡∏ö Combo
    if (type === 'correct' && combo >= 3) {
        msgList = aiCoachMsgs['combo'];
    }
    
    const msg = msgList[Math.floor(Math.random() * msgList.length)];
    const toast = document.getElementById('ai-coach-toast');
    document.getElementById('ai-coach-msg').innerText = msg;
    
    toast.classList.remove('hidden');
    toast.style.transform = 'translate(-50%, 0)';
    toast.style.opacity = '1';
    
    clearTimeout(coachTimeout);
    coachTimeout = setTimeout(() => {
        toast.style.transform = 'translate(-50%, -20px)';
        toast.style.opacity = '0';
        setTimeout(() => toast.classList.add('hidden'), 300);
    }, 3000); // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∞‡∏•‡∏≠‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏≤‡∏á‡∏´‡∏≤‡∏¢‡πÑ‡∏õ
}

function updateAIMentorHome() {
    const titleEl = document.getElementById('ai-status-title');
    const summaryEl = document.getElementById('ai-daily-summary');
    const actionBtn = document.getElementById('ai-action-btn');

    const totalWords = parseInt(localStorage.getItem('tCor')) || 0;
    const currentMistakes = JSON.parse(localStorage.getItem('vMis')) || [];
    const maxStreak = parseInt(localStorage.getItem('maxStreak')) || 0;
    
    // ‚è±Ô∏è ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏∞‡∏™‡∏° (‡∏ô‡∏≤‡∏ó‡∏µ)
    const studyMins = parseInt(localStorage.getItem('studyMins')) || 0;

    // --- üìö ‡∏Ñ‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡∏Ç‡∏≠‡∏á AI (‡πÇ‡∏ó‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå ‡∏û‡∏≠‡∏î‡∏µ‡πÜ ‡πÑ‡∏°‡πà‡πÄ‡∏ß‡∏≠‡∏£‡πå) ---

    // 1. ‡πÄ‡∏û‡∏¥‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)
    const introMsgs = [
        { t: "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢!", s: "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏≠‡∏ö‡∏™‡∏≤‡∏¢‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏∞‡∏™‡∏°‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤" },
        { t: "‡∏Å‡πâ‡∏≤‡∏ß‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô", s: "‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏∏‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡∏Ñ‡∏£‡∏±‡∏ö? ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏î‡∏π‡πÄ‡∏¢‡∏≠‡∏∞ ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏≤‡∏ó‡∏¢‡∏≠‡∏¢‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô ‡∏¢‡∏±‡∏á‡πÑ‡∏á‡∏Å‡πá‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô" },
        { t: "‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô", s: "‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏™‡∏≤‡∏¢‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏°‡∏≤‡πÄ‡∏Ñ‡∏≤‡∏∞‡∏™‡∏ô‡∏¥‡∏°‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏Å‡∏´‡∏ô‡πà‡∏≠‡∏¢ ‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡πÄ‡∏õ‡πá‡∏ô ‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡πÑ‡∏õ‡∏ô‡∏∞" },
        { t: "‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°", s: "‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏™‡∏≤‡∏¢‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏™‡∏π‡∏á‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏∞‡∏™‡∏°‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏≠‡∏á" },
        { t: "‡∏ß‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà", s: "‡∏à‡∏±‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏î‡∏µ ‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏≤‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏±‡∏Å 10-15 ‡∏ô‡∏≤‡∏ó‡∏µ‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ‡∏ô‡∏µ‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏®‡∏±‡∏û‡∏ó‡πå‡∏Å‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ó‡∏≥‡∏ô‡πâ‡∏≠‡∏¢‡πÅ‡∏ï‡πà‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î" },
        { t: "‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢", s: "‡∏•‡∏≠‡∏á‡∏ß‡∏≤‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÑ‡∏ß‡πâ‡∏™‡∏±‡∏Å‡∏û‡∏±‡∏Å ‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏°‡∏≤‡∏ò‡∏¥‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡∏Å‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö ‡∏™‡∏°‡∏≠‡∏á‡πÇ‡∏•‡πà‡∏á‡πÜ ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏à‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô" }
    ];

    // 2. ‡∏Å‡∏£‡∏ì‡∏µ‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î‡∏™‡∏∞‡∏™‡∏°‡πÄ‡∏¢‡∏≠‡∏∞ (‡πÄ‡∏ô‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô)
    const mistakeMsgs = [
        { t: "‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡πâ‡∏≥", s: `‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏ô‡πà‡∏≤‡∏à‡∏∞‡∏°‡∏µ‡∏®‡∏±‡∏û‡∏ó‡πå ${currentMistakes.length} ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡∏à‡∏≥‡∏™‡∏±‡∏ö‡∏™‡∏ô‡∏≠‡∏¢‡∏π‡πà ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏£‡∏≤‡∏°‡∏≤‡πÄ‡∏ô‡πâ‡∏ô‡∏¢‡πâ‡∏≥‡∏Ñ‡∏≥‡∏û‡∏ß‡∏Å‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÅ‡∏°‡πà‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ô‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤` },
        { t: "‡∏ú‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏£‡∏π", s: `‡πÉ‡∏ô‡∏™‡∏°‡∏∏‡∏î‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î‡∏™‡∏∞‡∏™‡∏°‡∏≠‡∏¢‡∏π‡πà ${currentMistakes.length} ‡∏Ñ‡∏≥‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ñ‡∏∑‡∏≠‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ô‡∏µ‡πâ‡∏°‡∏≤‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏û‡∏•‡∏≤‡∏î ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏ï‡πâ‡∏°‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≠‡∏ö‡∏à‡∏£‡∏¥‡∏á‡∏ô‡∏∞` },
        { t: "‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô", s: `‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå ${currentMistakes.length} ‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏¢‡∏≤‡∏Å‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á ‡∏•‡∏≠‡∏á‡∏à‡∏±‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏°‡∏≤‡∏ó‡∏ß‡∏ô‡∏ã‡πâ‡∏≥‡∏î‡∏π‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏≠‡∏∏‡∏î‡∏£‡∏≠‡∏¢‡∏£‡∏±‡πà‡∏ß‡∏Å‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏™‡∏≠‡∏ö` },
        { t: "‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ", s: `‡∏°‡∏µ‡∏®‡∏±‡∏û‡∏ó‡πå‡∏£‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡πÑ‡∏õ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏≠‡∏¢‡∏π‡πà ${currentMistakes.length} ‡∏Ñ‡∏≥‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÑ‡∏õ‡∏ó‡∏µ‡∏•‡∏∞‡∏Ñ‡∏≥ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏µ‡∏ö ‡πÅ‡∏ï‡πà‡∏≠‡∏¢‡πà‡∏≤‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ó‡∏¥‡πâ‡∏á‡πÑ‡∏ß‡πâ‡∏ô‡∏≤‡∏ô‡∏ô‡∏∞` },
        { t: "‡∏≠‡∏∏‡∏î‡∏£‡∏≠‡∏¢‡∏£‡∏±‡πà‡∏ß‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏≠‡∏ö", s: `‡∏°‡∏µ‡∏®‡∏±‡∏û‡∏ó‡πå ${currentMistakes.length} ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏à‡∏ö ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏à‡∏≠‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏à‡∏£‡∏¥‡∏á` },
        { t: "‡∏Å‡∏≤‡∏£‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏´‡∏±‡∏ß‡πÉ‡∏à", s: `‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡∏®‡∏±‡∏û‡∏ó‡πå ${currentMistakes.length} ‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏∞` },
        { t: "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á", s: `‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏°‡∏±‡∏Å‡∏à‡∏∞‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏ä‡∏≠‡∏ö‡∏™‡∏±‡∏ö‡∏™‡∏ô‡∏ô‡∏µ‡πà‡πÅ‡∏´‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏±‡∏ö‡∏®‡∏±‡∏û‡∏ó‡πå ${currentMistakes.length} ‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏î‡∏π‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö` },
        { t: "‡∏≠‡∏¢‡πà‡∏≤‡∏°‡∏≠‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î", s: `‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ö ‡∏®‡∏±‡∏û‡∏ó‡πå ${currentMistakes.length} ‡∏Ñ‡∏≥‡πÉ‡∏ô‡∏™‡∏°‡∏∏‡∏î‡∏ô‡∏µ‡πâ ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏™‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Å‡πá‡πÑ‡∏î‡πâ` }
    ];

    // 3. ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å (Streak ‡∏™‡∏π‡∏á) (‡∏ä‡∏°‡∏ï‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á ‡πÑ‡∏°‡πà‡πÄ‡∏ß‡πà‡∏≠‡∏£‡πå)
    const streakMsgs = [
        { t: "‡∏™‡∏°‡∏≤‡∏ò‡∏¥‡∏î‡∏µ‡∏°‡∏≤‡∏Å", s: `‡∏ó‡∏≥‡∏ñ‡∏π‡∏Å‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô ${maxStreak} ‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß! ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏¥‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏≤‡∏ò‡∏¥‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ô‡∏™‡∏≠‡∏ö‡∏à‡∏£‡∏¥‡∏á‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å` },
        { t: "‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡πÑ‡∏ß‡πâ", s: `‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö ${maxStreak} ‡∏Ç‡πâ‡∏≠‡∏ï‡∏¥‡∏î! ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡∏ó‡∏≤‡∏á‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏á‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö` },
        { t: "‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏°‡∏≤", s: `‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏£‡∏ß‡∏î ${maxStreak} ‡∏Ç‡πâ‡∏≠ ‡∏ñ‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡∏î‡∏µ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡∏™‡∏∞‡∏™‡∏°‡∏°‡∏≤‡∏°‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏≠‡∏Å‡∏ú‡∏•‡πÅ‡∏•‡πâ‡∏ß ‡∏•‡∏∏‡∏¢‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡∏ö` },
        { t: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏™‡∏π‡∏á", s: `‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ ${maxStreak} ‡∏Ç‡πâ‡∏≠‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô ‡∏û‡∏¥‡∏™‡∏π‡∏à‡∏ô‡πå‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏≠‡∏ö‡∏Ñ‡∏≠‡∏ö‡∏™‡∏π‡∏á‡∏Ñ‡∏£‡∏±‡∏ö ‡∏à‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ï‡∏≠‡∏ô‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ò‡∏¥‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡∏ô‡∏∞` },
        { t: "‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏µ", s: `‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å ${maxStreak} ‡∏Ç‡πâ‡∏≠‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏à‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ï‡∏≠‡∏ô‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ò‡∏¥‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡∏ô‡∏∞` },
        { t: "‡∏£‡∏≠‡∏ö‡∏Ñ‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥", s: `‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ ${maxStreak} ‡∏Ç‡πâ‡∏≠‡∏£‡∏ß‡∏î ‡πÅ‡∏™‡∏î‡∏á‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏≠‡∏ö‡∏Ñ‡∏≠‡∏ö‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏ä‡πâ‡∏≠‡∏¢‡∏™‡πå‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡∏¢` },
        { t: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏µ‡πà", s: `‡∏ó‡∏≥‡πÑ‡∏î‡πâ ${maxStreak} ‡∏Ç‡πâ‡∏≠‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏û‡∏•‡∏≤‡∏î‡πÄ‡∏•‡∏¢ ‡∏™‡∏°‡∏≠‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ä‡∏¥‡∏ô‡∏Å‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö ‡∏•‡∏∏‡∏¢‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢` },
        { t: "‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°", s: `‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö ${maxStreak} ‡∏Ç‡πâ‡∏≠ ‡∏ñ‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ü‡∏¥‡∏ï‡∏Ç‡∏≠‡∏á‡∏™‡∏°‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡∏ô‡∏∞` }
    ];

    // 4. ‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏•‡πà‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠)
    const normalMsgs = [
        { t: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏µ‡∏¢‡πå‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç", s: `‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡∏∞‡∏™‡∏°‡∏®‡∏±‡∏û‡∏ó‡πå‡πÑ‡∏õ‡πÑ‡∏î‡πâ ${totalWords} ‡∏Ñ‡∏≥‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Å‡∏≤‡∏£‡∏°‡∏µ‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡∏ß‡∏±‡∏ô‡∏•‡∏∞‡∏ô‡∏¥‡∏î ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏°‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏Ñ‡πà‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ô‡∏∞ ‡∏™‡∏π‡πâ‡πÜ` },
        { t: "‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ", s: `‡∏¢‡∏≠‡∏î‡∏™‡∏∞‡∏™‡∏° ${totalWords} ‡∏Ñ‡∏≥‡πÅ‡∏•‡πâ‡∏ß! ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏à‡∏≥‡πÑ‡∏î‡πâ ‡∏Ñ‡∏∑‡∏≠‡πÇ‡∏≠‡∏Å‡∏≤‡∏™ 1 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏™‡∏≤‡∏¢‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏±‡∏ö` },
        { t: "‡∏û‡∏±‡∏Å‡∏ö‡πâ‡∏≤‡∏á ‡∏•‡∏∏‡∏¢‡∏ö‡πâ‡∏≤‡∏á", s: `‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡∏≤‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ${totalWords} ‡∏Ñ‡∏≥ ‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢‡∏Å‡πá‡∏û‡∏±‡∏Å‡∏Å‡∏¥‡∏ô‡∏ô‡πâ‡∏≥ ‡∏¢‡∏∑‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏¢‡∏∑‡∏î‡∏™‡∏≤‡∏¢‡∏ö‡πâ‡∏≤‡∏á‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ó‡∏≥‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ï‡πà‡∏≠` },
        { t: "‡∏™‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡∏•‡∏∞‡∏Å‡πâ‡∏≤‡∏ß", s: `‡πÄ‡∏Å‡πá‡∏ö‡∏®‡∏±‡∏û‡∏ó‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡πÑ‡∏õ ${totalWords} ‡∏Ñ‡∏≥‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£‡∏Ñ‡∏£‡∏±‡∏ö ‡πÅ‡∏Ç‡πà‡∏á‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏Å‡πá‡∏û‡∏≠ ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏£‡∏π‡πâ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô‡∏Å‡πá‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡πÅ‡∏•‡πâ‡∏ß` },
        { t: "‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢", s: `‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏Ñ‡∏•‡∏±‡∏á‡∏®‡∏±‡∏û‡∏ó‡πå ${totalWords} ‡∏Ñ‡∏≥‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö ‡∏à‡∏≥‡πÑ‡∏ß‡πâ‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÅ‡∏Ñ‡πà 1 ‡∏Ç‡πâ‡∏≠‡∏Å‡πá‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÑ‡∏î‡πâ ‡∏™‡∏∞‡∏™‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏Ñ‡∏£‡∏±‡∏ö` },
        { t: "‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏™‡∏π‡πà‡∏™‡∏≤‡∏¢‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£", s: `‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ${totalWords} ‡∏Ñ‡∏≥ ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏î‡∏π‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏´‡∏ô‡∏ó‡∏≤‡∏á‡∏¢‡∏±‡∏á‡∏≠‡∏µ‡∏Å‡∏¢‡∏≤‡∏ß‡πÑ‡∏Å‡∏• ‡πÅ‡∏ï‡πà‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏°‡∏≤‡∏ñ‡∏π‡∏Å‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö` },
        { t: "‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå", s: `‡∏¢‡∏≠‡∏î‡∏™‡∏∞‡∏™‡∏° ${totalWords} ‡∏Ñ‡∏≥ ‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏≥‡∏ó‡∏µ‡∏•‡∏∞‡∏ô‡∏¥‡∏î‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏µ‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏™‡∏¥‡πà‡∏á‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡∏∞` },
        { t: "‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏î‡∏ú‡∏•‡πÑ‡∏î‡πâ", s: `‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ${totalWords} ‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ ‡∏Ñ‡∏∑‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÑ‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏î‡∏î‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏à‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ` }
    ];

    // ‚è±Ô∏è 5. ‡∏´‡∏°‡∏ß‡∏î‡πÉ‡∏´‡∏°‡πà: ‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
    const timeMsgs = [
        { t: "‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å", s: `‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏ï‡∏¥‡∏ß‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡∏°‡∏≤ ${studyMins} ‡∏ô‡∏≤‡∏ó‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏∑‡∏≠‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ô‡∏∞` },
        { t: "‡∏û‡∏±‡∏Å‡∏™‡∏≤‡∏¢‡∏ï‡∏≤‡∏ö‡πâ‡∏≤‡∏á‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö", s: `‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡∏®‡∏±‡∏û‡∏ó‡πå‡πÑ‡∏õ ${studyMins} ‡∏ô‡∏≤‡∏ó‡∏µ‡πÅ‡∏•‡πâ‡∏ß ‡∏ñ‡πâ‡∏≤‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ï‡∏≤‡∏•‡πâ‡∏≤ ‡∏•‡∏≠‡∏á‡∏°‡∏≠‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÑ‡∏Å‡∏•‡πÜ ‡∏û‡∏±‡∏Å‡∏™‡∏≤‡∏¢‡∏ï‡∏≤‡∏™‡∏±‡∏Å 1 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏∏‡∏¢‡∏ï‡πà‡∏≠‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö` },
        { t: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏¢‡∏®‡πÉ‡∏Ñ‡∏£", s: `‡πÄ‡∏ß‡∏•‡∏≤ ${studyMins} ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏™‡∏µ‡∏¢‡∏™‡∏•‡∏∞‡∏°‡∏≤‡∏ô‡∏±‡πà‡∏á‡∏ó‡πà‡∏≠‡∏á‡∏®‡∏±‡∏û‡∏ó‡πå ‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≠‡∏ö‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö` },
        { t: "‡∏™‡∏∞‡∏™‡∏°‡πÄ‡∏ß‡∏•‡∏≤ ‡∏™‡∏∞‡∏™‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ", s: `‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏°‡∏≤ ${studyMins} ‡∏ô‡∏≤‡∏ó‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏ó‡∏≥‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ö‡πà‡∏≠‡∏¢‡πÜ ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ï‡πâ‡∏ô‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏™‡∏≠‡∏ö‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡πÄ‡∏•‡∏¢‡∏ô‡∏∞` }
    ];

    // --- ü§ñ ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏û‡∏π‡∏î (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏ã‡πâ‡∏≥‡∏ã‡∏≤‡∏Å) ---
    let selectedMsg;

    if (totalWords === 0) {
        selectedMsg = introMsgs[Math.floor(Math.random() * introMsgs.length)];
        actionBtn.style.display = "none";
    } 
    else if (currentMistakes.length > 3) {
        // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î‡πÄ‡∏¢‡∏≠‡∏∞ ‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô
        selectedMsg = mistakeMsgs[Math.floor(Math.random() * mistakeMsgs.length)];
        actionBtn.style.display = "block"; 
    }
    else {
        // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î‡∏ô‡πâ‡∏≠‡∏¢ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡∏´‡∏°‡∏ß‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ (normalMsgs) ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å
        let messagePool = [...normalMsgs];
        
        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏¢‡∏°‡∏µ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡∏™‡∏π‡∏á‡πÜ (maxStreak >= 10) ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏≤‡∏Ñ‡∏≥‡∏ä‡∏°‡πÑ‡∏õ‡∏ú‡∏™‡∏°‡∏£‡∏ß‡∏°‡∏î‡πâ‡∏ß‡∏¢
        if (maxStreak >= 10) {
            messagePool = messagePool.concat(streakMsgs);
        }

        // üî• ‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 5 ‡∏ô‡∏≤‡∏ó‡∏µ ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏≤‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏°‡∏≤‡∏ú‡∏™‡∏°‡∏î‡πâ‡∏ß‡∏¢
        if (studyMins >= 5) {
            messagePool = messagePool.concat(timeMsgs);
        }
        
        // ‡∏™‡∏∏‡πà‡∏°‡∏´‡∏¢‡∏¥‡∏ö 1 ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ú‡∏™‡∏°‡πÅ‡∏•‡πâ‡∏ß
        selectedMsg = messagePool[Math.floor(Math.random() * messagePool.length)];
        actionBtn.style.display = "none";
    }

    // --- ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ç‡∏∂‡πâ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ ---
    titleEl.innerText = selectedMsg.t;
    summaryEl.innerText = selectedMsg.s;
}

        // --- üéÆ Standard Mode ---
        function startGame(limit) {
        isReviewMode = false;
            showScreen('screen-game');
            let pool = selCat === 'all' ? [...vocabDatabase] : vocabDatabase.filter(i => i.category === selCat);
            qs = pool.sort(() => Math.random() - 0.5);
            if(limit > 0) qs = qs.slice(0, limit);
            qIdx = 0; score = 0; corInRound = 0; fUsed = false; currentStreak = 0;
            const cb = document.getElementById('combo-display'); if(cb) cb.innerHTML = "";
            document.getElementById('btn-5050').disabled = false; document.getElementById('btn-5050').style.opacity = "1";
            loadQ();
        }
        
       function startReviewMode() {
    if(mistakes.length === 0) return;
    
    playSnd('snd-click');
    document.getElementById('m-modal').classList.add('hidden'); // ‡∏õ‡∏¥‡∏î‡∏™‡∏°‡∏∏‡∏î
    
    isReviewMode = true; // ‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏Ñ‡πâ‡∏ô
    
    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏à‡∏≤‡∏Å‡∏™‡∏°‡∏∏‡∏î‡∏à‡∏î‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î
    qs = [...mistakes]; // ‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏à‡∏ó‡∏¢‡πå
    qs = qs.sort(() => Math.random() - 0.5); // ‡∏™‡∏•‡∏±‡∏ö‡∏Ç‡πâ‡∏≠
    
    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÜ
    qIdx = 0; 
    score = 0; 
    corInRound = 0; 
    
    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡∏õ‡∏Å‡∏ï‡∏¥
    showScreen('screen-game');
    document.getElementById('btn-5050').disabled = false; 
    document.getElementById('btn-5050').style.opacity = "1";
    
    loadQ(); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
}

        function loadQ() {
            if (qIdx >= qs.length) return endGame();
            isAns = false; const item = qs[qIdx];
            setTxt('prog-txt', `${qIdx+1}/${qs.length}`);
            setTxt('q-word', item.word);
            setTxt('q-read', `/ ${item.read} /`);
            document.getElementById('btn-next').classList.add('hidden');
            let choices = [item.meaning, ...vocabDatabase.filter(w => w.meaning !== item.meaning).sort(() => Math.random() - 0.5).slice(0, 3).map(d => d.meaning)].sort(() => Math.random() - 0.5);
            const area = document.getElementById('choices-area'); area.innerHTML = '';
            choices.forEach(c => {
                const b = document.createElement('button'); b.className = 'choice-btn'; b.innerText = c;
                b.onclick = () => { playSnd('snd-click'); check(b, c, item.meaning); };
                area.appendChild(b);
            });
            startTimer();
        }

        function startTimer() {
            if(tInt) cancelAnimationFrame(tInt);
            const duration = 10000; let startTime = null; const bar = document.getElementById('t-bar');
            function step(timestamp) {
                if (!startTime) startTime = timestamp;
                const elapsed = timestamp - startTime; const remaining = Math.max(0, duration - elapsed); const pct = (remaining / duration) * 100;
                bar.style.width = pct + "%";
                if (remaining > 0 && !isAns) tInt = requestAnimationFrame(step);
                else if (remaining <= 0 && !isAns) check(null, '', qs[qIdx].meaning);
            }
            tInt = requestAnimationFrame(step);
        }
        
function check(btn, sel, cor) {
    if (isAns) return; 
    isAns = true; 
    if(tInt) cancelAnimationFrame(tInt);
    
    // ‡∏•‡πá‡∏≠‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏ã‡πâ‡∏≥
    document.querySelectorAll('.choice-btn').forEach(b => b.disabled = true);
    
    // ‡πÇ‡∏´‡∏•‡∏î Style ‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏° (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ)
    const styles = document.createElement('style'); 
    styles.innerHTML = `.correct { background: var(--success)!important; color: white!important; border-color: var(--success)!important; } .wrong { background: var(--danger)!important; color: white!important; border-color: var(--danger)!important; }`; 
    document.head.appendChild(styles);
    
    if (sel === cor) {
        // --- ‚úÖ ‡∏Å‡∏£‡∏ì‡∏µ‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å ---
        if(btn) btn.classList.add('correct');
        showAICoach('correct', currentStreak + 1);
        
        // üî• ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏´‡∏°‡∏î (Logic ‡πÉ‡∏´‡∏°‡πà)
        if (isReviewMode) {
            // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏Ñ‡πâ‡∏ô: ‡∏•‡∏ö‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏™‡∏°‡∏∏‡∏î
            mistakes = mistakes.filter(m => m.meaning !== cor);
            localStorage.setItem('vMis', JSON.stringify(mistakes)); 
            setTxt('score-txt', `Left: ${mistakes.length}`); // ‡πÇ‡∏ä‡∏ß‡πå‡∏ß‡πà‡∏≤‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡∏Å‡∏µ‡πà‡∏Ñ‡∏≥
        } else {
            // ‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏°‡∏î‡∏õ‡∏Å‡∏ï‡∏¥: ‡∏Ñ‡∏¥‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°
            corInRound++; tCor++;
            let mult = handleUniversalCombo(true, 'combo-normal'); 
            score += mult; 
            setTxt('score-txt', `Score: ${score}`);
        }

        playSnd('snd-correct'); 
        setTimeout(nextQ, 1000); // ‡πÑ‡∏õ‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

    } else {
        // --- ‚ùå ‡∏Å‡∏£‡∏ì‡∏µ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î ---
        if(btn) btn.classList.add('wrong');
        showAICoach('wrong');
        
        // ‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏°‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ‡πÉ‡∏´‡πâ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö (‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÑ‡∏°‡πà‡∏ô‡∏±‡∏ö‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö)
        if (!isReviewMode) handleUniversalCombo(false, 'combo-normal');
        
        // ‡πÄ‡∏â‡∏•‡∏¢‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å
        document.querySelectorAll('.choice-btn').forEach(b => { 
            if(b.innerText === cor) b.classList.add('correct'); 
        });
        
        playSnd('snd-wrong');
        
        // ‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏°‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏à‡∏î‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ -> ‡∏à‡∏î‡∏•‡∏á‡∏™‡∏°‡∏∏‡∏î
        // (‡∏™‡πà‡∏ß‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏°‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏°‡∏∏‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß)
        if(!isReviewMode && !mistakes.find(m => m.word === qs[qIdx].word)) { 
            mistakes.push(qs[qIdx]); 
            localStorage.setItem('vMis', JSON.stringify(mistakes)); 
        }
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° "‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ" ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡πÄ‡∏≠‡∏á
        document.getElementById('btn-next').classList.remove('hidden');
    }
    setTxt('score-txt', `Score: ${score}`);
}
        function use5050() { if (fUsed || isAns) return; playSnd('snd-click'); fUsed = true; document.getElementById('btn-5050').disabled = true; document.getElementById('btn-5050').style.opacity = "0.4"; const cor = qs[qIdx].meaning; const btns = Array.from(document.querySelectorAll('.choice-btn')); let rem = 0; btns.sort(() => Math.random() - 0.5).forEach(b => { if (b.innerText !== cor && rem < 2) { b.style.visibility = 'hidden'; rem++; } }); }
        function nextQ() { qIdx++; loadQ(); }

       function startTFGame() {
    playSnd('snd-click'); 
    showScreen('screen-tf');
    tfLives = 3; 
    tfScore = 0; 
    updateTFLife(); 
    setTxt('tf-score-txt', "Score: 0"); 
    
    initSwipeEvents(); // üî• ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏±‡∏î
    nextTFQ();
}
        function updateTFLife() { let h = ""; for(let i=0;i<tfLives;i++) h += "‚ù§Ô∏è"; for(let i=tfLives;i<3;i++) h += "üñ§"; setTxt('tf-life', h); }
        function nextTFQ() {
            if(tfLives <= 0) return endTFGame();
            resetCard();
            let pool = selCat === 'all' ? vocabDatabase : vocabDatabase.filter(i => i.category === selCat); if(pool.length === 0) pool = vocabDatabase;
            const base = pool[Math.floor(Math.random() * pool.length)];
            tfCorrect = Math.random() > 0.5;
            let shownMeaning = base.meaning;
            if (!tfCorrect) {
                let wrong = pool[Math.floor(Math.random() * pool.length)];
                while(wrong.meaning === base.meaning && pool.length > 1) wrong = pool[Math.floor(Math.random() * pool.length)];
                shownMeaning = wrong.meaning;
            }
            setTxt('tf-word', base.word); setTxt('tf-mean', shownMeaning); startTFTimer();
        }
        function startTFTimer() {
            if(tfInt) cancelAnimationFrame(tfInt); const duration = 4000; let startTime = null; const bar = document.getElementById('tf-bar');
            function step(timestamp) {
                if (!startTime) startTime = timestamp; const elapsed = timestamp - startTime; const remaining = Math.max(0, duration - elapsed); const pct = (remaining / duration) * 100; bar.style.width = pct + "%";
                if (remaining > 0) tfInt = requestAnimationFrame(step); else timeoutTF();
            }
            tfInt = requestAnimationFrame(step);
        }
        function timeoutTF() { playSnd('snd-wrong'); tfLives--; updateTFLife(); document.getElementById('screen-tf').style.background = "#ffeaa7"; setTimeout(() => document.getElementById('screen-tf').style.background = "white", 200); nextTFQ(); }
       function answerTF(ans) {
    if(tfInt) cancelAnimationFrame(tfInt);

    if (ans === tfCorrect) { 
        playSnd('snd-correct');
        
        // üî• ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà: ‡∏Ñ‡∏¥‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏ö‡∏ö Combo
        let mult = handleUniversalCombo(true, 'combo-tf');
        let points = 1 * mult;
        
        tfScore += points; 
        tXP += points; 
        
        setTxt('tf-score-txt', "Score: " + tfScore); 
        nextTFQ(); 
    } else { 
        playSnd('snd-wrong'); 
        
        // üî• ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà: ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Combo
        handleUniversalCombo(false, 'combo-tf');
        
        tfLives--; updateTFLife(); nextTFQ(); 
    }
    localStorage.setItem('tXP', tXP);
}
        function endTFGame() { playSnd('snd-win'); showScreen('screen-end'); setTxt('end-msg', "Game Over! ‚ö°"); setTxt('f-score', tfScore + " Points"); document.getElementById('stars').innerHTML = ""; setTxt('bonus-notif', ""); setTxt('streak-summary', ""); localStorage.setItem('tXP', tXP); }

        // --- üß© Vowel Game Logic ---
        function startVowelGame() {
            playSnd('snd-click'); showScreen('screen-vowel');
            voLives = 3; voScore = 0; updateVoLife(); setTxt('vo-score-txt', "Score: 0"); nextVoQ();
        }
        function updateVoLife() { let h = ""; for(let i=0;i<voLives;i++) h += "‚ù§Ô∏è"; for(let i=voLives;i<3;i++) h += "üñ§"; setTxt('vo-life', h); }
        function nextVoQ() {
            if(voLives <= 0) return endVoGame();
            let pool = selCat === 'all' ? vocabDatabase : vocabDatabase.filter(i => i.category === selCat); if(pool.length === 0) pool = vocabDatabase;
            let validWords = pool.filter(w => /[aeiou]/i.test(w.word)); if(validWords.length === 0) validWords = pool;
            const item = validWords[Math.floor(Math.random() * validWords.length)];
            const matches = [...item.word.matchAll(/[aeiou]/gi)]; if(matches.length === 0) { nextVoQ(); return; }
            const target = matches[Math.floor(Math.random() * matches.length)];
            voCorrect = target[0].toLowerCase();
            const displayWord = item.word.substring(0, target.index) + "_" + item.word.substring(target.index + 1);
            setTxt('vo-word', displayWord); setTxt('vo-mean', item.meaning);
            const vowels = ['a', 'e', 'i', 'o', 'u']; let choices = [voCorrect];
            while(choices.length < 4) { let r = vowels[Math.floor(Math.random() * vowels.length)]; if(!choices.includes(r)) choices.push(r); }
            choices.sort(() => Math.random() - 0.5);
            const area = document.getElementById('vo-choices'); area.innerHTML = '';
            choices.forEach(v => {
                const b = document.createElement('button'); b.className = 'vowel-btn'; b.innerText = v;
                b.onclick = () => { playSnd('snd-click'); checkVo(b, v); };
                area.appendChild(b);
            });
            startVoTimer();
        }
        function startVoTimer() {
            if(voInt) cancelAnimationFrame(voInt); const duration = 8000; let startTime = null; const bar = document.getElementById('vo-bar');
            function step(timestamp) {
                if (!startTime) startTime = timestamp; const elapsed = timestamp - startTime; const remaining = Math.max(0, duration - elapsed); const pct = (remaining / duration) * 100; bar.style.width = pct + "%";
                if (remaining > 0) voInt = requestAnimationFrame(step); else timeoutVo();
            }
            voInt = requestAnimationFrame(step);
        }
        function timeoutVo() { playSnd('snd-wrong'); voLives--; updateVoLife(); document.getElementById('screen-vowel').style.background = "#ffcccc"; setTimeout(() => document.getElementById('screen-vowel').style.background = "white", 200); nextVoQ(); }
        function checkVo(btn, ans) {
    if(voInt) cancelAnimationFrame(voInt); 
    document.querySelectorAll('.vowel-btn').forEach(b => b.disabled = true);
    
    if(ans === voCorrect) { 
        btn.classList.add('correct'); 
        playSnd('snd-correct'); 
        
        // üî• ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
        let mult = handleUniversalCombo(true, 'combo-vo');
        let points = 1 * mult;
        
        voScore += points; 
        tXP += (points + 1); 
        
        setTxt('vo-score-txt', "Score: " + voScore); 
        setTimeout(nextVoQ, 600); 
    } else { 
        btn.classList.add('wrong'); 
        playSnd('snd-wrong'); 
        
        // üî• ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
        handleUniversalCombo(false, 'combo-vo');
        
        voLives--; updateVoLife(); 
        document.querySelectorAll('.vowel-btn').forEach(b => { 
            if(b.innerText === voCorrect) b.classList.add('correct'); 
        }); 
        setTimeout(nextVoQ, 1000); 
    }
    localStorage.setItem('tXP', tXP);
}
        function endVoGame() { playSnd('snd-win'); showScreen('screen-end'); setTxt('end-msg', "Game Over! üß©"); setTxt('f-score', voScore + " Points"); document.getElementById('stars').innerHTML = ""; setTxt('bonus-notif', ""); setTxt('streak-summary', ""); localStorage.setItem('tXP', tXP); }

        // --- üìù Sentence Game Logic ---
        let senLives = 3, senScore = 0, currentSenObj = null, userSentence = [];

        function startSentenceGame() {
            playSnd('snd-click'); showScreen('screen-sentence');
            senLives = 3; senScore = 0; updateSenLife(); setTxt('sen-score-txt', "Score: 0"); nextSentenceQ();
        }

        function updateSenLife() { 
            let h = ""; for(let i=0;i<senLives;i++) h += "‚ù§Ô∏è"; for(let i=senLives;i<3;i++) h += "üñ§"; 
            setTxt('sen-life', h); 
        }

        function nextSentenceQ() {
            if(senLives <= 0) return endSentenceGame();
            
            document.getElementById('sen-feedback').classList.add('hidden');
            document.getElementById('sen-next-btn').classList.add('hidden');
            
            let pool = sentenceDB;
            if (selCat && selCat.startsWith('sen-')) {
                const targetLevel = selCat.split('-')[1];
                const filtered = sentenceDB.filter(s => s.level === targetLevel);
                if (filtered.length > 0) pool = filtered;
            }

            currentSenObj = pool[Math.floor(Math.random() * pool.length)];
            userSentence = [];
            
            setTxt('sen-mean', currentSenObj.th);
            const ansArea = document.getElementById('sen-answer-area');
            ansArea.innerHTML = '<span style="color:#bdc3c7; font-size:0.9rem;">(‡πÅ‡∏ï‡∏∞‡∏Ñ‡∏≥‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏á)</span>';
            ansArea.className = 'sentence-box'; 
            document.getElementById('sen-check-btn').classList.add('hidden');

            let words = currentSenObj.en.split(' '); 
            words.sort(() => Math.random() - 0.5);

            const choiceArea = document.getElementById('sen-choices');
            choiceArea.innerHTML = '';
            words.forEach((w, idx) => {
                const btn = document.createElement('button');
                btn.className = 'word-chip'; btn.innerText = w; btn.id = `w-${idx}`;
                btn.onclick = () => selectWord(w, btn);
                choiceArea.appendChild(btn);
            });
        }

        function selectWord(word, btnElement) {
            if (!document.getElementById('sen-next-btn').classList.contains('hidden')) return;

            playSnd('snd-click');
            const ansArea = document.getElementById('sen-answer-area');
            if(userSentence.length === 0) ansArea.innerHTML = '';
            
            btnElement.classList.add('in-answer');
            btnElement.onclick = () => removeWord(word, btnElement);
            ansArea.appendChild(btnElement);
            userSentence.push(word);

            const remaining = document.getElementById('sen-choices').children.length;
            if (remaining === 0) document.getElementById('sen-check-btn').classList.remove('hidden');
        }

        function removeWord(word, btnElement) {
            if (!document.getElementById('sen-next-btn').classList.contains('hidden')) return;

            playSnd('snd-click');
            const choiceArea = document.getElementById('sen-choices');
            btnElement.classList.remove('in-answer');
            btnElement.onclick = () => selectWord(word, btnElement);
            choiceArea.appendChild(btnElement);
            
            const index = userSentence.lastIndexOf(word);
            if (index > -1) userSentence.splice(index, 1);
            
            document.getElementById('sen-check-btn').classList.add('hidden');
            if(userSentence.length === 0) document.getElementById('sen-answer-area').innerHTML = '<span style="color:#bdc3c7; font-size:0.9rem;">(‡πÅ‡∏ï‡∏∞‡∏Ñ‡∏≥‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏á)</span>';
        }

        function checkSentence() {
    const builtSen = userSentence.join(' ').trim();
    const correctSen = currentSenObj.en.trim();
    const box = document.getElementById('sen-answer-area');
    const feedback = document.getElementById('sen-feedback');

    if (builtSen === correctSen) {
        playSnd('snd-correct'); 
        box.classList.add('correct'); 
        
        // üî• ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
        let mult = handleUniversalCombo(true, 'combo-sen');
        let points = 10 * mult;
        
        senScore += points; 
        tXP += (5 * mult);
        
        setTxt('sen-score-txt', "Score: " + senScore);
        setTimeout(nextSentenceQ, 1000);
    } else {
        playSnd('snd-wrong'); 
        box.classList.add('wrong'); 
        
        // üî• ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
        handleUniversalCombo(false, 'combo-sen');
        
        senLives--; 
        updateSenLife();
        feedback.innerHTML = `‚ùå <b>‡πÄ‡∏â‡∏•‡∏¢:</b> <span style="color:#d63031; font-weight:bold;">${correctSen}</span>`;
        feedback.classList.remove('hidden');
        document.getElementById('sen-check-btn').classList.add('hidden');
        document.getElementById('sen-next-btn').classList.remove('hidden');
    }
    localStorage.setItem('tXP', tXP);
}
        function endSentenceGame() {
            playSnd('snd-win'); showScreen('screen-end'); setTxt('end-msg', "Game Over! üìù");
            setTxt('f-score', senScore + " Points"); document.getElementById('stars').innerHTML = "";
            setTxt('bonus-notif', ""); setTxt('streak-summary', "");
        }

        // --- Common ---
        function endGame() {
            let bonus = (corInRound === qs.length && qs.length > 0) ? 50 : 0;
            if(bonus > 0) tPerf++; tXP += (score + bonus);
            let tg = parseInt(localStorage.getItem('totalGames'))||0; tg++; localStorage.setItem('totalGames', tg);
            
            localStorage.setItem('tXP', tXP); localStorage.setItem('tCor', tCor); localStorage.setItem('tPerf', tPerf);
            playSnd('snd-win'); showScreen('screen-end');
            setTxt('end-msg', "‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏ß! üéâ"); setTxt('f-score', score + " Points");
            setTxt('bonus-notif', bonus > 0 ? "‚ú® PERFECT BONUS +50 XP ‚ú®" : "");
            setTxt('streak-summary', `Max Combo: ${maxStreak}`);
            const sDiv = document.getElementById('stars'); sDiv.innerHTML = '';
            let pct = (corInRound/qs.length)*100; for(let i=1; i<=3; i++) sDiv.innerHTML += `<span style="color:${pct >= i*33 ? '#f1c40f' : '#dfe6e9'}">‚òÖ</span>`;
            showAIPostGameSummary(pct);
        }

        function openMistakes() {
    playSnd('snd-click'); 
    
    // üî• ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏°‡∏≤: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏õ‡∏∏‡πà‡∏°‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏Ñ‡πâ‡∏ô
    const btnRev = document.getElementById('btn-revenge');
    if(btnRev) {
        if(mistakes.length > 0) {
            btnRev.style.display = 'block'; // ‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡∏∏‡πà‡∏°‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î
            btnRev.innerText = `üíÄ ‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏Ñ‡πâ‡∏ô (${mistakes.length} ‡∏Ñ‡∏≥)`;
        } else {
            btnRev.style.display = 'none';  // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î
        }
    }

    const area = document.getElementById('m-list'); 
    area.innerHTML = mistakes.length ? "" : "<p style='color:#b2bec3; text-align:center;'>‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å! ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î‡πÄ‡∏•‡∏¢</p>";
    
    mistakes.forEach((m, i) => { 
        const item = document.createElement('div');
        item.style = "display:flex; justify-content:space-between; align-items:center; padding:15px; border-bottom:1px solid #eee; font-size: 1rem;";
        item.innerHTML = `<span><b>${m.word}</b><br><small style='color:#636e72'>${m.meaning}</small></span>`;
        const delBtn = document.createElement('button');
        delBtn.innerHTML = "üóëÔ∏è"; delBtn.style = "color:#ff7675; border:none; background:none; font-size: 1.2rem; cursor: pointer;";
        delBtn.onclick = () => { playSnd('snd-click'); remM(i); };
        item.appendChild(delBtn); area.appendChild(item);
    });
    
    document.getElementById('m-modal').classList.remove('hidden');
}
        function remM(i) { mistakes.splice(i, 1); localStorage.setItem('vMis', JSON.stringify(mistakes)); openMistakes(); updateUI(); }
        /* --- üì± TINDER LOGIC (Touch & Mouse) --- */
const card = document.getElementById('tf-card');
const txtYes = document.getElementById('txt-yes');
const txtNo = document.getElementById('txt-no');

let isDragging = false;
let startX = 0;
let currentX = 0;
let tfGameActive = false; 

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö event
function initSwipeEvents() {
    // Touch
    if(card) {
        card.addEventListener('touchstart', dragStart);
        card.addEventListener('touchmove', dragMove);
        card.addEventListener('touchend', dragEnd);
        // Mouse
        card.addEventListener('mousedown', dragStart);
        document.addEventListener('mousemove', dragMove);
        document.addEventListener('mouseup', dragEnd);
    }
}

function dragStart(e) {
    if(!tfGameActive) return;
    isDragging = true;
    startX = (e.type === 'touchstart') ? e.touches[0].clientX : e.clientX;
    card.style.transition = 'none'; 
}

function dragMove(e) {
    if (!isDragging) return;
    e.preventDefault(); 

    let x = (e.type === 'touchmove') ? e.touches[0].clientX : e.clientX;
    currentX = x - startX;
    let rotate = currentX * 0.1; 

    card.style.transform = `translateX(${currentX}px) rotate(${rotate}deg)`;

    if (currentX > 0) {
        txtYes.style.opacity = Math.min(currentX / 100, 1);
        txtNo.style.opacity = 0;
    } else {
        txtNo.style.opacity = Math.min(Math.abs(currentX) / 100, 1);
        txtYes.style.opacity = 0;
    }
}

function dragEnd(e) {
    if (!isDragging) return;
    isDragging = false;
    
    const threshold = 100; 

    if (currentX > threshold) {
        finishSwipe('right');
    } else if (currentX < -threshold) {
        finishSwipe('left');
    } else {
        card.style.transition = 'transform 0.3s ease';
        card.style.transform = 'translateX(0) rotate(0)';
        txtYes.style.opacity = 0;
        txtNo.style.opacity = 0;
    }
}

function manualSwipe(dir) {
    if(!tfGameActive) return;
    finishSwipe(dir);
}

function finishSwipe(dir) {
    tfGameActive = false; 
    if (dir === 'right') {
        card.classList.add('fly-right');
        setTimeout(() => answerTF(true), 300); 
    } else {
        card.classList.add('fly-left');
        setTimeout(() => answerTF(false), 300); 
    }
}

function resetCard() {
    card.classList.remove('fly-left', 'fly-right');
    card.style.transition = 'none';
    card.style.transform = 'scale(0.8)'; 
    card.style.opacity = '0';
    if(txtYes) txtYes.style.opacity = 0;
    if(txtNo) txtNo.style.opacity = 0;
    
    setTimeout(() => {
        card.style.transition = 'all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
        card.style.transform = 'scale(1) translateX(0) rotate(0)';
        card.style.opacity = '1';
        tfGameActive = true; 
    }, 50);
}
// --- üî• UNIVERSAL COMBO SYSTEM ---
function handleUniversalCombo(isCorrect, uiId) {
    const ui = document.getElementById(uiId);
    
    if (isCorrect) {
        currentStreak++;
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
        if(currentStreak > maxStreak) { 
            maxStreak = currentStreak; 
            localStorage.setItem('maxStreak', maxStreak); 
        }

        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì
        let mult = 1;
        let comboClass = "combo-badge";
        let icon = "üî•";
        
        if (currentStreak >= 10) { 
            mult = 3; // ‡∏Ñ‡∏π‡∏ì 3 ‡∏ñ‡πâ‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô 10 ‡∏Ç‡πâ‡∏≠
            comboClass += " combo-god"; 
            icon = "‚ö°"; 
        } else if (currentStreak >= 5) { 
            mult = 2; // ‡∏Ñ‡∏π‡∏ì 2 ‡∏ñ‡πâ‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô 5 ‡∏Ç‡πâ‡∏≠
            comboClass += " combo-high"; 
            icon = "üöÄ"; 
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
        if (currentStreak > 1 && ui) {
             ui.innerHTML = `<div class="${comboClass}">${icon} COMBO x${currentStreak} (x${mult} Exp)</div>`;
        } else if (ui) {
             ui.innerHTML = "";
        }
        
        return mult; // ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏Ñ‡∏¥‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
    } else {
        currentStreak = 0; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ñ‡πâ‡∏≤‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î
        if(ui) ui.innerHTML = "";
        return 1;
    }
}
// --- üÉè Flashcard Game Logic (‡πÅ‡∏Å‡πâ‡∏ö‡∏±‡∏Ñ 100%) ---
        let fcQueue = [];
        let fcCurrent = null;
        let fcTotal = 0;
        let fcCount = 0;

        function startFlashcardMode() {
            playSnd('snd-click'); 
            showScreen('screen-flashcard');
            
            let pool = selCat === 'all' ? [...vocabDatabase] : vocabDatabase.filter(i => i.category === selCat);
            if(pool.length === 0) pool = [...vocabDatabase];
            
            fcQueue = pool.sort(() => Math.random() - 0.5).slice(0, 20); 
            fcTotal = fcQueue.length;
            fcCount = 0;
            
            nextFlashcard();
        }

        function nextFlashcard() {
            const card = document.getElementById('fc-card');
            const controls = document.getElementById('fc-controls');
            
            // üõë ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏û‡∏£‡∏¥‡∏ö‡∏ï‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (‡πÅ‡∏Å‡πâ‡∏ö‡∏±‡∏Ñ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ñ‡πâ‡∏≤‡∏á)
            card.style.transition = 'none'; 
            card.classList.remove('is-flipped', 'swipe-left', 'swipe-right');
            
            // ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏û‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î
            controls.style.opacity = '0.3';
            controls.style.pointerEvents = 'none';
            
            if (fcQueue.length === 0) {
                playSnd('snd-win');
                tXP += 30; 
                localStorage.setItem('tXP', tXP);
                showScreen('screen-end');
                setTxt('end-msg', "‡∏à‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÑ‡∏î‡πâ‡∏´‡∏°‡∏î‡∏Å‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß! üÉè");
                setTxt('f-score', "‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡∏°‡∏≤‡∏Å!");
                document.getElementById('stars').innerHTML = "üåüüåüüåü";
                setTxt('bonus-notif', "+30 XP Bonus (‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏ü‡∏•‡∏ä‡∏Å‡∏≤‡∏£‡πå‡∏î)");
                setTxt('streak-summary', `‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÅ‡∏ü‡∏•‡∏ä‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÑ‡∏õ ${fcCount} ‡∏Ñ‡∏≥`);
                return;
            }
            
            fcCurrent = fcQueue[0];
            fcCount++;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤
            setTxt('fc-progress-txt', `${fcCount} / ${fcTotal}`);
            document.getElementById('fc-progress-bar').style.width = `${(fcCount / fcTotal) * 100}%`;
            
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå
            setTxt('fc-word-en', fcCurrent.word);
            setTxt('fc-word-th', fcCurrent.meaning);
            setTxt('fc-word-read', `/ ${fcCurrent.read} /`);

            // üü¢ ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥
            setTimeout(() => {
                card.style.transition = 'transform 0.6s cubic-bezier(0.4, 0.2, 0.2, 1), opacity 0.4s';
            }, 50);
        }

        function flipCard() {
            const card = document.getElementById('fc-card');
            const controls = document.getElementById('fc-controls');
            
            playSnd('snd-click');
            // ‚úÖ ‡πÉ‡∏ä‡πâ toggle ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ã‡πâ‡∏≥‡πÅ‡∏•‡πâ‡∏ß‡∏û‡∏•‡∏¥‡∏Å‡πÑ‡∏õ‡∏û‡∏•‡∏¥‡∏Å‡∏°‡∏≤‡πÑ‡∏î‡πâ‡∏≠‡∏¥‡∏™‡∏£‡∏∞
            card.classList.toggle('is-flipped'); 
            
            // ‡∏ñ‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏´‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà (‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•) ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡∏´‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏´‡πâ‡∏•‡πá‡∏≠‡∏Ñ‡∏õ‡∏∏‡πà‡∏°
            if (card.classList.contains('is-flipped')) {
                controls.style.opacity = '1';
                controls.style.pointerEvents = 'auto';
            } else {
                controls.style.opacity = '0.3';
                controls.style.pointerEvents = 'none';
            }
        }

function swipeFlashcard(remembered) {
            const card = document.getElementById('fc-card');
            const controls = document.getElementById('fc-controls');
            
            controls.style.opacity = '0.3';
            controls.style.pointerEvents = 'none';
            
            if (remembered) {
                playSnd('snd-correct'); // ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ñ‡∏π‡∏Å‡∏¢‡∏±‡∏á‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ
                card.classList.add('swipe-right'); 
                fcQueue.shift(); 
                tXP++; localStorage.setItem('tXP', tXP);
            } else {
                // ü§´ ‡πÄ‡∏≠‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡∏á playSnd('snd-wrong'); ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö
                card.classList.add('swipe-left'); 
                let word = fcQueue.shift();
                fcQueue.push(word); 
                fcTotal++; 
                
                if(!mistakes.find(m => m.word === word.word)) {
                    mistakes.push(word);
                    localStorage.setItem('vMis', JSON.stringify(mistakes));
                }
            }
            
            setTimeout(() => {
                nextFlashcard();
            }, 400); 
        }
// --- üß† ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ú‡∏•‡∏´‡∏•‡∏±‡∏á‡∏à‡∏ö‡πÄ‡∏Å‡∏° ---
function showAIPostGameSummary(percentCorrect) {
    const msgEl = document.getElementById('ai-postgame-msg');
    let messages = [];
    
    // ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å
    if (percentCorrect === 100) {
        messages = [
            "‡πÄ‡∏û‡∏≠‡∏£‡πå‡πÄ‡∏ü‡∏Å‡∏ï‡πå! ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏ä‡∏±‡∏ß‡∏£‡πå‡πÜ ‡πÇ‡∏Ñ‡∏ï‡∏£‡πÄ‡∏à‡πã‡∏á‡∏Ñ‡∏£‡∏±‡∏ö!",
            "‡πÑ‡∏£‡πâ‡∏ó‡∏µ‡πà‡∏ï‡∏¥! ‡∏™‡∏°‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏î‡∏à‡∏≥‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÑ‡∏î‡πâ‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å ‡∏û‡∏±‡∏Å‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏ä‡∏∑‡πà‡∏ô‡πÉ‡∏à‡πÜ ‡∏ã‡∏±‡∏Å‡πÅ‡∏Å‡πâ‡∏ß‡∏ô‡∏∞"
        ];
    } else if (percentCorrect >= 70) {
        messages = [
            "‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ú‡πà‡∏≤‡∏ô‡∏â‡∏•‡∏∏‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏û‡∏•‡∏≤‡∏î‡πÅ‡∏Ñ‡πà‡∏ô‡∏¥‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÄ‡∏≠‡∏á ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏Ñ‡∏∏‡∏ì‡∏î‡∏µ‡∏°‡∏≤‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞ ‡∏•‡∏∏‡∏¢‡∏ï‡πà‡∏≠!",
            "‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡πÅ‡∏û‡∏ó‡∏£‡∏¥‡∏Ñ‡∏à‡∏î‡∏•‡∏á‡∏™‡∏°‡∏∏‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏™‡πÄ‡∏•‡∏¢"
        ];
    } else if (percentCorrect >= 40) {
        messages = [
            "‡∏°‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß! ‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏´‡∏•‡∏≠‡∏Å‡πÄ‡∏¢‡∏≠‡∏∞‡πÑ‡∏õ‡∏´‡∏ô‡πà‡∏≠‡∏¢ ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Ñ‡∏≥‡πÉ‡∏´‡∏°‡πà‡πÜ ‡πÄ‡∏û‡∏µ‡∏¢‡∏ö‡πÄ‡∏•‡∏¢‡∏ô‡∏∞",
            "‡πÑ‡∏°‡πà‡πÅ‡∏¢‡πà‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å! ‡∏à‡∏≥‡πÑ‡∏ß‡πâ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ú‡∏¥‡∏î‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ‡∏ô‡∏µ‡πâ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤‡πÑ‡∏õ‡∏ú‡∏¥‡∏î‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≠‡∏ö ‡∏•‡∏∏‡∏¢‡∏Å‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà!"
        ];
    } else {
        messages = [
            "‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏Ñ‡∏á‡∏à‡∏∞‡πÄ‡∏Ç‡∏µ‡πâ‡∏¢‡∏ß‡πÑ‡∏õ‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£‡∏ô‡∏∞ ‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏•‡∏∂‡∏Å‡πÜ ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÇ‡∏´‡∏°‡∏î 10 ‡∏Ç‡πâ‡∏≠ ‡∏î‡∏π‡∏Å‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏°?",
            "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏≠‡∏Å‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏≥‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡πà‡∏≠‡∏¢‡∏°‡∏≤‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà ‡πÅ‡∏û‡∏ó‡∏£‡∏¥‡∏Ñ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏°‡∏≠"
        ];
    }
    
    // ‡∏™‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á
    const finalMsg = messages[Math.floor(Math.random() * messages.length)];
    msgEl.innerText = finalMsg;
}
function openAIStats() {
        if(typeof playSnd === 'function') playSnd('snd-click');
        
        const studyMins = parseInt(localStorage.getItem('studyMins')) || 0;
        const tCor = parseInt(localStorage.getItem('tCor')) || 0;
        
        // 1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå (‡∏≠‡∏¥‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ 4,000 ‡∏Ñ‡∏≥)
        let readyScore = Math.floor((tCor / 4000) * 100);
        if(readyScore > 100) readyScore = 100;
        if(readyScore < 0) readyScore = 0;
        
        const readyBar = document.getElementById('ai-ready-bar');
        const readyPct = document.getElementById('ai-ready-pct');
        const readyTxt = document.getElementById('ai-ready-text');
        
        if(readyPct) readyPct.innerText = readyScore + "%";
        setTimeout(() => { if(readyBar) readyBar.style.width = readyScore + "%"; }, 100);
        
        let color = "var(--danger)";
        let txt = "‡πÄ‡∏û‡∏¥‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á! ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏≠‡∏µ‡∏Å‡πÄ‡∏û‡∏µ‡∏¢‡∏ö‡∏£‡∏≠‡∏≠‡∏¢‡∏π‡πà ‡∏•‡∏∏‡∏¢‡πÄ‡∏•‡∏¢! üöÄ";
        if(readyScore >= 80) { color = "var(--success)"; txt = "‡∏Ñ‡∏•‡∏±‡∏á‡∏®‡∏±‡∏û‡∏ó‡πå‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏ó‡∏û! ‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏à‡∏∞‡∏≠‡∏≠‡∏Å‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏°‡πà‡∏´‡∏ß‡∏±‡πà‡∏ô‡πÅ‡∏•‡πâ‡∏ß üëë"; }
        else if(readyScore >= 50) { color = "#0984e3"; txt = "‡∏°‡∏≤‡πÑ‡∏Å‡∏•‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞‡πÄ‡∏ô‡∏µ‡πà‡∏¢! ‡∏≠‡πà‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏¢‡∏≤‡∏ß‡πÜ ‡πÑ‡∏î‡πâ‡∏™‡∏ö‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß üåü"; }
        else if(readyScore >= 20) { color = "var(--accent)"; txt = "‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏•‡πá‡∏Å‡∏ú‡∏™‡∏°‡∏ô‡πâ‡∏≠‡∏¢‡πÑ‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏Ñ‡∏•‡∏±‡∏á‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡πÅ‡∏•‡πâ‡∏ß üìà"; }
        
        if(readyPct) readyPct.style.color = color;
        if(readyBar) readyBar.style.background = color;
        if(readyTxt) readyTxt.innerText = txt;
        
        // 2. ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á
        const chartArea = document.getElementById('ai-chart-area');
        const labelsArea = document.getElementById('ai-chart-labels');
        let history = JSON.parse(localStorage.getItem('chartHistory')) || [];
        
        // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏¥‡πâ‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏à‡∏≠‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏™‡πÅ‡∏•‡∏ä "/" 
        if (history.length > 0 && history[0].date && history[0].date.includes('/')) {
            history = [];
            localStorage.setItem('chartHistory', JSON.stringify([]));
        }
        
        const dateObj = new Date();
        const todayStr = dateObj.getDate() + " " + ['‡∏°.‡∏Ñ.','‡∏Å.‡∏û.','‡∏°‡∏µ.‡∏Ñ.','‡πÄ‡∏°.‡∏¢.','‡∏û.‡∏Ñ.','‡∏°‡∏¥.‡∏¢.','‡∏Å.‡∏Ñ.','‡∏™.‡∏Ñ.','‡∏Å.‡∏¢.','‡∏ï.‡∏Ñ.','‡∏û.‡∏¢.','‡∏ò.‡∏Ñ.'][dateObj.getMonth()];
        
        let displayHistory = [...history];
        let todayRecordIndex = displayHistory.findIndex(h => h.date === todayStr);
        if(todayRecordIndex > -1) { 
            displayHistory[todayRecordIndex].val = studyMins; 
        } else { 
            displayHistory.push({ date: todayStr, val: studyMins }); 
        }
        
        // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≤‡∏ü‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 5 ‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏°‡∏≠
        while(displayHistory.length < 5) { displayHistory.unshift({ date: "-", val: 0 }); }
        if(displayHistory.length > 5) displayHistory = displayHistory.slice(-5);
        
        let maxVal = Math.max(...displayHistory.map(d => d.val), 15);
        
        if(chartArea) chartArea.innerHTML = ""; 
        if(labelsArea) labelsArea.innerHTML = "";
        displayHistory.forEach((item, i) => {
            let heightPct = (item.val / maxVal) * 100;
            let isToday = (i === displayHistory.length - 1);
            let barColor = isToday ? "var(--primary)" : "#a29bfe";
            
            if(chartArea) chartArea.innerHTML += `
                <div style="display: flex; flex-direction: column; align-items: center; width: 18%;">
                    <span style="font-size: 0.75rem; color: #636e72; font-weight:bold; margin-bottom: 5px;">${item.val}m</span>
                    <div style="width: 100%; background: #f1f2f6; border-radius: 8px; height: 75px; position: relative; overflow: hidden; display: flex; align-items: flex-end;">
                        <div style="width: 100%; background: ${barColor}; height: ${heightPct}%; border-radius: 8px; transition: height 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);"></div>
                    </div>
                </div>
            `;
            if(labelsArea) labelsArea.innerHTML += `<span style="width: 18%; text-align:center; font-size: 0.75rem; color: ${isToday ? 'var(--primary-dark)' : '#b2bec3'}; white-space: nowrap; overflow: hidden;">${item.date}</span>`;
        });
        
        // 3. ‡πÄ‡∏£‡∏î‡∏≤‡∏£‡πå‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô (‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î‡∏ö‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)
        const radarArea = document.getElementById('ai-weakness-radar');
        const mistakes = JSON.parse(localStorage.getItem('vMis')) || [];
        
        if (radarArea) {
            if (mistakes.length === 0) {
                radarArea.innerHTML = "<div style='text-align:center; color: #2ecc71; font-weight:bold; padding: 10px 0;'>‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å! ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô‡πÄ‡∏•‡∏¢ üéâ</div>";
            } else {
                let catCounts = {};
                mistakes.forEach(m => {
                    let c = m.category || '‡∏≠‡∏∑‡πà‡∏ô‡πÜ';
                    catCounts[c] = (catCounts[c] || 0) + 1;
                });
                
                let sortedCats = Object.keys(catCounts).map(k => {
                    return { cat: k, count: catCounts[k] };
                }).sort((a, b) => b.count - a.count).slice(0, 4); 
                
                const catNames = {
                    'verbs3': '‚ö° ‡∏Å‡∏£‡∏¥‡∏¢‡∏≤ 3 ‡∏ä‡πà‡∏≠‡∏á', 'sen-easy': 'üå± ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ: ‡∏á‡πà‡∏≤‡∏¢', 'sen-medium': 'üåø ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ: ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á', 'sen-hard': 'üå≥ ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ: ‡∏¢‡∏≤‡∏Å',
                    'body': 'üëÄ ‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢', 'home': 'üè† ‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ö‡πâ‡∏≤‡∏ô', 'clothing': 'üëï ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤', 'feelings': 'üòä ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å', 'food': 'üçî ‡∏≠‡∏≤‡∏´‡∏≤‡∏£',
                    'family': 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß', 'school': 'üè´ ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', 'places': 'üèôÔ∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà', 'action': 'üèÉ‚Äç‚ôÇÔ∏è ‡∏Ñ‡∏≥‡∏Å‡∏£‡∏¥‡∏¢‡∏≤', 'jobs': 'üëÆ ‡∏≠‡∏≤‡∏ä‡∏µ‡∏û',
                    'description': 'üìè ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞', 'animal': 'üê∂ ‡∏™‡∏±‡∏ï‡∏ß‡πå', 'vehicle': 'üöó ‡∏¢‡∏≤‡∏ô‡∏û‡∏≤‡∏´‡∏ô‡∏∞', 'color': 'üé® ‡∏™‡∏µ/‡∏ó‡∏£‡∏á', 'time': 'üìÖ ‡∏ß‡∏±‡∏ô/‡πÄ‡∏ß‡∏•‡∏≤',
                    'sports': '‚öΩ ‡∏Å‡∏µ‡∏¨‡∏≤', 'hobby': 'üß∏ ‡∏á‡∏≤‡∏ô‡∏≠‡∏î‡∏¥‡πÄ‡∏£‡∏Å', 'fruits': 'üçè ‡∏ú‡∏•‡πÑ‡∏°‡πâ/‡∏ú‡∏±‡∏Å', 'nature': '‚õàÔ∏è ‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥', 'technology': 'üíª ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ',
                    'grammar': 'üó£Ô∏è ‡πÑ‡∏ß‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå', 'personality': 'üé≠ ‡∏ô‡∏¥‡∏™‡∏±‡∏¢', 'shopping': 'üõçÔ∏è ‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á', 'education': 'üéì ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤', 'health': 'üè• ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û',
                    'travel': '‚úàÔ∏è ‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß', 'law': '‚öñÔ∏è ‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢', 'space': 'üåå ‡∏≠‡∏ß‡∏Å‡∏≤‡∏®', 'environment': '‚ôªÔ∏è ‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°', 'tools': 'üõ†Ô∏è ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠',
                    'fantasy_creature': 'üêâ ‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÉ‡∏ô‡∏ï‡∏≥‡∏ô‡∏≤‡∏ô', 'materials': '‚õìÔ∏è ‡∏ß‡∏±‡∏™‡∏î‡∏∏', 'phrasal_verb': 'üî• ‡∏Å‡∏£‡∏¥‡∏¢‡∏≤‡∏ß‡∏•‡∏µ', 'slang': 'üëæ ‡πÅ‡∏™‡∏•‡∏á',
                    'military': 'ü™ñ ‡∏Å‡∏≤‡∏£‡∏ó‡∏´‡∏≤‡∏£', 'idioms': 'üí¨ ‡∏™‡∏≥‡∏ô‡∏ß‡∏ô', 'basic': 'üë§ ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô'
                };

                let html = "";
                let maxMistakes = sortedCats[0].count; 
                
                sortedCats.forEach(item => {
                    let displayName = catNames[item.cat] || item.cat;
                    let barPct = (item.count / maxMistakes) * 100; 
                    
                    html += `
                    <div style="margin-bottom: 15px;">
                        <div style="display:flex; justify-content:space-between; margin-bottom: 6px; font-size: 0.95rem; font-weight: 800; color: var(--text-main);">
                            <span>${displayName}</span>
                            <span style="color: var(--danger); background: #fff0f0; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem;">‡∏û‡∏•‡∏≤‡∏î ${item.count} ‡∏Ñ‡∏≥</span>
                        </div>
                        <div style="background: #f1f2f6; height: 12px; border-radius: 6px; overflow: hidden; position: relative;">
                            <div style="background: linear-gradient(90deg, #ff7675, #d63031); width: ${barPct}%; height: 100%; border-radius: 6px;"></div>
                        </div>
                    </div>
                    `;
                });
                
                html += `
                <button onclick="document.getElementById('ai-stats-modal').classList.add('hidden'); openMistakes();" style="width: 100%; margin-top: 10px; padding: 10px; background: #ffeaa7; color: #d35400; border: none; border-radius: 12px; font-weight: bold; cursor: pointer;">
                    üìñ ‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏°‡∏∏‡∏î‡∏à‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô
                </button>`;
                
                radarArea.innerHTML = html;
            }
        }
        
        const modal = document.getElementById('ai-stats-modal');
        if(modal) modal.classList.remove('hidden');
    }

    function closeAIStats() {
        if(typeof playSnd === 'function') playSnd('snd-click');
        const modal = document.getElementById('ai-stats-modal');
        if(modal) modal.classList.add('hidden');
    }

    // --- ‚è±Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏±‡∏ô‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô ---
    function checkDailyReset() {
        const dateObj = new Date();
        const todayStr = dateObj.getDate() + " " + ['‡∏°.‡∏Ñ.','‡∏Å.‡∏û.','‡∏°‡∏µ.‡∏Ñ.','‡πÄ‡∏°.‡∏¢.','‡∏û.‡∏Ñ.','‡∏°‡∏¥.‡∏¢.','‡∏Å.‡∏Ñ.','‡∏™.‡∏Ñ.','‡∏Å.‡∏¢.','‡∏ï.‡∏Ñ.','‡∏û.‡∏¢.','‡∏ò.‡∏Ñ.'][dateObj.getMonth()];
        
        const lastDate = localStorage.getItem('lastStudyDate');
        
        // ‡∏ñ‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏Å‡πà‡∏≤ (‡∏°‡∏µ /) ‡πÉ‡∏´‡πâ‡πÄ‡∏ã‡πá‡∏ï‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        if (lastDate && lastDate.includes('/')) {
            localStorage.setItem('lastStudyDate', todayStr);
            return;
        }
        
        if (lastDate && lastDate !== todayStr) {
            let history = JSON.parse(localStorage.getItem('chartHistory')) || [];
            let lastMins = parseInt(localStorage.getItem('studyMins')) || 0;
            
            if(!history.find(h => h.date === lastDate)) {
                history.push({ date: lastDate, val: lastMins });
            }
            if(history.length > 5) history.shift(); 
            localStorage.setItem('chartHistory', JSON.stringify(history));
            
            localStorage.setItem('studyMins', 0);
        }
        localStorage.setItem('lastStudyDate', todayStr);
    }
    
    checkDailyReset(); 
    
    if(window.studyTimerInt) clearInterval(window.studyTimerInt);
    window.studyTimerInt = setInterval(() => {
        checkDailyReset();
        let currentMins = parseInt(localStorage.getItem('studyMins')) || 0;
        localStorage.setItem('studyMins', currentMins + 1);
    }, 60000);
    // --- üèÜ ‡∏£‡∏∞‡∏ö‡∏ö Leaderboard ‡πÅ‡∏Ç‡πà‡∏á‡∏Å‡∏±‡∏ö Bot ‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï 10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö) ---
        function initBots() {
            let bots = JSON.parse(localStorage.getItem('rankBots'));
            let lastUpdate = parseInt(localStorage.getItem('botLastUpdate')) || Date.now();
            let currentXP = parseInt(localStorage.getItem('tXP')) || 0;

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ß‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏≠‡∏ó ‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏≠‡∏ó‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏Å‡πà‡∏≤ (‡∏°‡∏µ‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á 9 ‡∏ï‡∏±‡∏ß) ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏Å‡πä‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            if (!bots || bots.length !== 9) {
                bots = [
                    { name: "‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà ‡∏£.‡∏ï.‡∏ï. ‡∏û‡∏®‡∏¥‡∏ô üëÆ‚Äç‚ôÇÔ∏è", score: currentXP + 2500, rate: 35 }, // ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö 1 ‡∏ï‡∏•‡∏≠‡∏î‡∏Å‡∏≤‡∏• ‡∏Ç‡∏¢‡∏±‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå
                    { name: "‡∏™‡∏≠‡∏ö‡∏ï‡∏¥‡∏î‡∏õ‡∏µ‡∏ô‡∏µ‡πâ‡∏™‡∏≤‡∏ò‡∏∏ üôè", score: currentXP + 1200, rate: 28 }, // ‡∏™‡∏≤‡∏¢‡∏°‡∏π‡πÄ‡∏ï‡∏•‡∏π ‡πÅ‡∏ï‡πâ‡∏°‡∏û‡∏∏‡πà‡∏á‡∏õ‡∏£‡∏µ‡πâ‡∏î
                    { name: "‡∏Ñ‡∏£‡∏π‡∏û‡∏µ‡πà‡∏û‡∏•‡∏≠‡∏¢ ‡∏ï‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå üìö", score: currentXP + 850, rate: 22 }, // ‡∏ï‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏°‡∏≤‡πÄ‡∏≠‡∏á
                    { name: "Kritt_99 üëæ", score: currentXP + 450, rate: 18 }, // ‡∏™‡∏≤‡∏¢‡πÄ‡∏Å‡∏°‡πÄ‡∏°‡∏≠‡∏£‡πå ‡πÅ‡∏≠‡∏ö‡∏°‡∏≤‡∏ï‡∏¥‡∏ß
                    { name: "‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏ß üò≠", score: currentXP + 150, rate: 15 }, // ‡∏ö‡πà‡∏ô‡πÅ‡∏ï‡πà‡πÅ‡∏ï‡πâ‡∏°‡πÄ‡∏¢‡∏≠‡∏∞
                    { name: "‡∏ô‡∏±‡∏Å‡∏™‡∏π‡πâ‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà üî•", score: currentXP + 50, rate: 12 }, // ‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏™‡∏µ‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì
                    { name: "Mook_Mink üå∏", score: Math.max(0, currentXP - 120), rate: 10 }, // ‡∏Ñ‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô
                    { name: "SleepyHead üí§", score: Math.max(0, currentXP - 350), rate: 8 }, // ‡∏Ñ‡∏ô‡∏á‡πà‡∏ß‡∏á‡∏ô‡∏≠‡∏ô‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤
                    { name: "‡πÅ‡∏Ñ‡πà‡∏™‡∏≠‡∏ö‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡πá‡∏û‡∏≠ ‚úåÔ∏è", score: Math.max(0, currentXP - 600), rate: 5 } // ‡∏™‡∏≤‡∏¢‡∏ä‡∏¥‡∏• ‡∏Ç‡∏≠‡πÅ‡∏Ñ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏¥‡∏ô‡∏¥‡∏°‡∏±‡∏°
                ];
                localStorage.setItem('rankBots', JSON.stringify(bots));
                localStorage.setItem('botLastUpdate', Date.now());
            } else {
                // üõë ‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏´‡∏î: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå‡πÅ‡∏•‡πâ‡∏ß‡∏ö‡∏ß‡∏Å‡πÅ‡∏ï‡πâ‡∏°‡πÉ‡∏´‡πâ‡∏ö‡∏≠‡∏ó
                let now = Date.now();
                let diffMins = Math.floor((now - lastUpdate) / 120000); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å‡πÜ 2 ‡∏ô‡∏≤‡∏ó‡∏µ
                
                if (diffMins > 0) {
                    let cycles = Math.min(diffMins, 300); // ‡∏•‡∏¥‡∏°‡∏¥‡∏ï‡∏ö‡∏ß‡∏Å‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10 ‡∏ä‡∏°.
                    bots.forEach(b => {
                        let bonusXP = Math.floor(Math.random() * b.rate * cycles) + (2 * cycles);
                        b.score += bonusXP;
                    });
                    localStorage.setItem('rankBots', JSON.stringify(bots));
                    localStorage.setItem('botLastUpdate', now);
                }
            }
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏´‡πâ‡∏ö‡∏≠‡∏ó‡∏ó‡∏∏‡∏Å‡πÜ 2 ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ‡∏≠‡∏¢‡∏π‡πà
        if(window.botTimerInt) clearInterval(window.botTimerInt);
        window.botTimerInt = setInterval(() => {
            let bots = JSON.parse(localStorage.getItem('rankBots'));
            if(bots && bots.length === 9) {
                bots.forEach(b => {
                    b.score += Math.floor(Math.random() * b.rate) + 3;
                });
                localStorage.setItem('rankBots', JSON.stringify(bots));
                localStorage.setItem('botLastUpdate', Date.now());
                
                const lbModal = document.getElementById('leaderboard-modal');
                if(lbModal && !lbModal.classList.contains('hidden')) {
                    renderLeaderboard();
                }
            }
        }, 120000);

        function openLeaderboard() {
            if(typeof playSnd === 'function') playSnd('snd-click');
            initBots(); 
            renderLeaderboard();
            document.getElementById('leaderboard-modal').classList.remove('hidden');
        }

        function closeLeaderboard() {
            if(typeof playSnd === 'function') playSnd('snd-click');
            document.getElementById('leaderboard-modal').classList.add('hidden');
        }

        function renderLeaderboard() {
            let bots = JSON.parse(localStorage.getItem('rankBots')) || [];
            let currentXP = parseInt(localStorage.getItem('tXP')) || 0;
            
            // ‡∏£‡∏ß‡∏°‡∏Ñ‡∏∏‡∏ì (‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏£‡∏¥‡∏á) ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà 10
            let allPlayers = [...bots, { name: "‡∏Ñ‡∏∏‡∏ì (You) üöÄ", score: currentXP, isUser: true }];
            
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏à‡∏≤‡∏Å XP ‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢
            allPlayers.sort((a, b) => b.score - a.score);
            
            let listHTML = "";
            allPlayers.forEach((p, index) => {
                let rankStr = index + 1;
                let medal = "";
                if (index === 0) { medal = "ü•á"; }
                else if (index === 1) { medal = "ü•à"; }
                else if (index === 2) { medal = "ü•â"; }
                else { medal = `<span style="color:#b2bec3; font-size:1.3rem; font-weight:900;">${rankStr}</span>`; }
                
                let userClass = p.isUser ? "rank-item is-user" : "rank-item";
                
                listHTML += `
                <div class="${userClass}">
                    <div class="rank-medal">${medal}</div>
                    <div class="rank-name">${p.name}</div>
                    <div class="rank-score" style="${p.isUser ? '' : 'color: var(--primary);'}">${p.score.toLocaleString()} XP</div>
                </div>
                `;
            });
            
            document.getElementById('lb-list').innerHTML = listHTML;
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏£‡πâ‡∏á‡∏Å‡∏¥‡πâ‡∏á
        initBots();
    </script>
  <div id="ai-coach-toast" class="hidden" style="position: fixed; top: 20px; left: 50%; transform: translate(-50%, -20px); width: 90%; max-width: 400px; background: white; border-radius: 16px; padding: 15px 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); border-left: 5px solid var(--primary); display: flex; align-items: center; gap: 15px; z-index: 9999; opacity: 0; transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55); pointer-events: none;">
    <img src="image_0.png" style="width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--primary); object-fit: cover; flex-shrink: 0;">
    <div>
        <span style="font-size: 0.75rem; font-weight: 800; color: var(--primary); letter-spacing: 0.5px;">AI MENTOR</span>
        <p id="ai-coach-msg" style="margin: 3px 0 0; font-size: 0.95rem; color: var(--text-main); font-weight: 600; line-height: 1.3;"></p>
    </div>
</div>
</body>
</html>
